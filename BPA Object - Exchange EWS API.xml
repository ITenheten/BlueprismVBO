<process name="Exchange EWS API" version="1.0" bpversion="6.2.1.4272" narrative="[[ Exchange Web Services Managed API ]]&#xD;&#xA;&#xD;&#xA;Init EWS: Initialize EWS service. Uses default credentials on VBO load. Any further actions use that service instance.&#xD;&#xA;Send Mail - Create new message.&#xD;&#xA;Get Mail List - Get list of messages in mailbox\folders, with filters.&#xD;&#xA;Get Mail Message - Get mail message by Id.&#xD;&#xA;Reply Mail\Forward Mail - Reply\Forward emails by Id.&#xD;&#xA;Move Item\Delete Item - Move\Delete emails by Id (or any other exchange item) " byrefcollection="true" type="object" runmode="Background" preferredid="9522082a-16d1-4a1d-81fb-e69ad4170893">
  <appdef>
    <element name="Application Root">
      <id>def2f684-fd2d-4ba0-9293-2d68f7ed2bff</id>
      <type>Application</type>
      <basetype>Application</basetype>
      <datatype>unknown</datatype>
      <diagnose>False</diagnose>
    </element>
  </appdef>
  <view>
    <camerax>-176</camerax>
    <cameray>-125</cameray>
    <zoom version="2">1.25</zoom>
  </view>
  <preconditions>
    <condition narrative="Requires Microsoft.Exchange.WebServices.dll // https://github.com/OfficeDev/ews-managed-api // MIT License" />
  </preconditions>
  <endpoint narrative="" />
  <subsheet subsheetid="ee631c7b-bad4-4777-810d-e06dd68cea55" type="CleanUp" published="True">
    <name>Clean Up</name>
    <view>
      <camerax>0</camerax>
      <cameray>0</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="ecd50929-c3ed-4beb-912d-ca77d6acfa5c" type="Normal" published="True">
    <name>Init EWS</name>
    <view>
      <camerax>0</camerax>
      <cameray>-68</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="cfd207ec-87c8-44e7-b2c5-a2e12a6a5c2f" type="Normal" published="True">
    <name>Send Mail</name>
    <view>
      <camerax>0</camerax>
      <cameray>0</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="41708016-914c-4bc9-aba4-3776db6744d5" type="Normal" published="True">
    <name>Reply Mail</name>
    <view>
      <camerax>0</camerax>
      <cameray>0</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="0cc882a5-1042-4931-90e4-99e354e4834d" type="Normal" published="True">
    <name>Forward Mail</name>
    <view>
      <camerax>0</camerax>
      <cameray>0</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="62f373a8-15b4-4b2d-9764-5b78ee54c82a" type="Normal" published="True">
    <name>Delete Item</name>
    <view>
      <camerax>0</camerax>
      <cameray>0</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="a68c4138-c645-46e9-9732-b716123b0320" type="Normal" published="True">
    <name>Move Item</name>
    <view>
      <camerax>0</camerax>
      <cameray>0</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="b48f8483-0de2-4ce2-8fe0-3cea3f83da30" type="Normal" published="True">
    <name>Get Mail List</name>
    <view>
      <camerax>246</camerax>
      <cameray>0</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="6c76e60b-8270-4f91-90d0-d3772af9c368" type="Normal" published="True">
    <name>Get Mail Message</name>
    <view>
      <camerax>218</camerax>
      <cameray>-96</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="006d2192-6cd3-44fb-ad13-15130026e046" type="Normal" published="False">
    <name>Get Appointment List</name>
    <view>
      <camerax>-524</camerax>
      <cameray>0</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="b024d2ea-8736-49c2-997b-6077e372fe79" type="Normal" published="True">
    <name>mail.isRead</name>
    <view>
      <camerax>0</camerax>
      <cameray>0</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="edb81c89-db1e-447e-8544-811f39c2499a" type="Normal" published="False">
    <name>Debug</name>
    <view>
      <camerax>0</camerax>
      <cameray>0</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="262b9785-395f-49ee-a46b-783d90474dfe" type="Normal" published="True">
    <name>EscapeDataString</name>
    <view>
      <camerax>0</camerax>
      <cameray>0</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="803a9ddd-7269-4e95-a8b6-92d7407a2c03" type="Normal" published="True">
    <name>HtmlEncode</name>
    <view>
      <camerax>0</camerax>
      <cameray>0</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="5f99001b-44d2-4251-8a8d-cabf2104ef3a" type="Normal" published="True">
    <name>mailtoLink</name>
    <view>
      <camerax>0</camerax>
      <cameray>1</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <stage stageid="3396bd7d-81d0-4e40-b9d5-c73a97b75085" name="Start" type="Start">
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-195</displayx>
    <displayy>-225</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>13e21552-aebe-4778-9615-8190f1339314</onsuccess>
  </stage>
  <stage stageid="d062cb7b-bd38-4e7b-b32c-7c090b15ed2a" name="End" type="End">
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-195</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="590ed852-34d2-406b-982a-bccacafe3cf6" name="Stage1" type="ProcessInfo">
    <narrative>
    </narrative>
    <displayx>-480</displayx>
    <displayy>-165</displayy>
    <displaywidth>390</displaywidth>
    <displayheight>150</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <references>
      <reference>System.dll</reference>
      <reference>System.Data.dll</reference>
      <reference>System.Xml.dll</reference>
      <reference>System.Drawing.dll</reference>
      <reference>C:\Program Files\Microsoft\Exchange\Web Services\2.2\Microsoft.Exchange.WebServices.dll</reference>
      <reference>System.Collections.dll</reference>
      <reference>System.Web.dll</reference>
      <reference>System.Core.dll</reference>
      <reference>System.IO.dll</reference>
      <reference>System.Linq.dll</reference>
    </references>
    <imports>
      <import>System</import>
      <import>System.Drawing</import>
      <import>System.Data</import>
      <import>Microsoft.Exchange.WebServices.Data</import>
      <import>System.Collections.Generic</import>
      <import>System.Web</import>
      <import>System.Text</import>
      <import>System.IO</import>
      <import>System.Linq</import>
    </imports>
    <language>csharp</language>
    <globalcode><![CDATA[]]></globalcode>
    <code><![CDATA[//////////////////////////////////////////////////////////////////////////////
// One ExchangeService is public for all tabs in VBO.
//////////////////////////////////////////////////////////////////////////////
ExchangeService service;

//////////////////////////////////////////////////////////////////////////////
// .Net BUG Workaround
// https://stackoverflow.com/questions/39467609/the-specified-time-zone-isnt-valid-using-ews-from-server
static TimeZoneInfo getCorrectTimeZone()
{
  return TimeZoneInfo.CreateCustomTimeZone("Local", TimeZoneInfo.Local.BaseUtcOffset, "Local", "Local");
}

//////////////////////////////////////////////////////////////////////////////
// Convert Enum to Dictionary, so we can pass it as a string to actions.  
static Dictionary<string, WellKnownFolderName> WellKnownFolderNameDict = new Dictionary<string, WellKnownFolderName> {
{"Calendar", WellKnownFolderName.Calendar }, 					//The Calendar folder.
{"Contacts", WellKnownFolderName.Contacts }, 					//The Contacts folder.
{"DeletedItems", WellKnownFolderName.DeletedItems }, 			//The Deleted Items folder.
{"Drafts", WellKnownFolderName.Drafts }, 						//The Drafts folder.
{"Inbox", WellKnownFolderName.Inbox }, 							//The Inbox folder.
{"Journal", WellKnownFolderName.Journal }, 						//The Journal folder.
{"Notes", WellKnownFolderName.Notes }, 							//The Notes folder.
{"Outbox", WellKnownFolderName.Outbox }, 						//The Outbox folder.
{"SentItems", WellKnownFolderName.SentItems }, 					//The Sent Items folder.
{"Tasks", WellKnownFolderName.Tasks }, 							//The Tasks folder.
{"MsgFolderRoot", WellKnownFolderName.MsgFolderRoot }, 			//The root of the message folder hierarchy.
{"PublicFoldersRoot", WellKnownFolderName.PublicFoldersRoot },	//The root of the Public Folders hierarchy.
{"Root", WellKnownFolderName.Root }, 							//The root of the mailbox.
{"JunkEmail", WellKnownFolderName.JunkEmail }, 					//The Junk E-mail folder.
{"SearchFolders", WellKnownFolderName.SearchFolders }, 			//The Search Folders folder, also known as the Finder folder.
{"VoiceMail", WellKnownFolderName.VoiceMail }, 					//The Voicemail folder.
{"RecoverableItemsRoot", WellKnownFolderName.RecoverableItemsRoot }, 			//The root of the Recoverable Items folder hierarchy.
{"RecoverableItemsDeletions", WellKnownFolderName.RecoverableItemsDeletions }, 	//The root of the folder hierarchy of recoverable items that have been soft-deleted from the Deleted Items folder.
{"RecoverableItemsVersions", WellKnownFolderName.RecoverableItemsVersions }, 	//The root of the Recoverable Items versions folder hierarchy in the archive mailbox.
{"RecoverableItemsPurges", WellKnownFolderName.RecoverableItemsPurges }, 		//The root of the folder hierarchy of recoverable items that have been hard-deleted from the Deleted Items folder.
{"ArchiveRoot", WellKnownFolderName.ArchiveRoot }, 								//The root of the folder hierarchy in the archive mailbox.
{"ArchiveMsgFolderRoot", WellKnownFolderName.ArchiveMsgFolderRoot }, 			//The root of the message folder hierarchy in the archive mailbox.
{"ArchiveDeletedItems", WellKnownFolderName.ArchiveDeletedItems }, 				//The Deleted Items folder in the archive mailbox.
{"ArchiveRecoverableItemsRoot", WellKnownFolderName.ArchiveRecoverableItemsRoot }, 			//The root of the Recoverable Items folder hierarchy in the archive mailbox.
{"ArchiveRecoverableItemsDeletions", WellKnownFolderName.ArchiveRecoverableItemsDeletions },//The root of the folder hierarchy of recoverable items that have been soft-deleted from the Deleted Items folder of the archive mailbox.
{"ArchiveRecoverableItemsVersions", WellKnownFolderName.ArchiveRecoverableItemsVersions }, 	//The root of the Recoverable Items versions folder hierarchy in the archive mailbox.
{"ArchiveRecoverableItemsPurges", WellKnownFolderName.ArchiveRecoverableItemsPurges }, 		//The root of the hierarchy of recoverable items that have been hard-deleted from the Deleted Items folder of the archive mailbox.
{"SyncIssues", WellKnownFolderName.SyncIssues }, 				//The Sync Issues folder. The SyncIssues field is applicable for clients that target Exchange Online and versions of Exchange starting with Exchange Server 2013.
{"Conflicts", WellKnownFolderName.Conflicts }, 					//The Conflicts folder. The Conflicts field is applicable for clients that target Exchange Online and versions of Exchange starting with Exchange Server 2013.
{"LocalFailures", WellKnownFolderName.LocalFailures }, 			//The Local Failures folder. The LocalFailures field is applicable for clients that target Exchange Online and versions of Exchange starting with Exchange Server 2013.
{"ServerFailures", WellKnownFolderName.ServerFailures }, 		//The Server Failures folder. The ServerFailures field is applicable for clients that target Exchange Online and versions of Exchange starting with Exchange Server 2013.
{"RecipientCache", WellKnownFolderName.RecipientCache }, 		//The Recipient Cache folder. The RecipientCache field is applicable for clients that target Exchange Online and versions of Exchange starting with Exchange Server 2013.
{"QuickContacts", WellKnownFolderName.QuickContacts }, 			//The Quick Contacts folder. The QuickContacts field is applicable for clients that target Exchange Online and versions of Exchange starting with Exchange Server 2013.
{"ConversationHistory", WellKnownFolderName.ConversationHistory }, //The Conversation History folder. The ConversationHistory field is applicable for clients that target Exchange Online and versions of Exchange starting with Exchange Server 2013.
{"ToDoSearch", WellKnownFolderName.ToDoSearch } 				//The To Do Search folder. The ToDoSearch field is applicable for clients that target Exchange Online and versions of Exchange starting with Exchange Server 2013.
};

//////////////////////////////////////////////////////////////////////////////
// Searching FolderId by Folder Name
//////////////////////////////////////////////////////////////////////////////
// 1) Attempt to find folder with exact name. WellKnownFolderName can be found with Enum name (e.g. "Inbox", "My folder")
//    Limitation: If a folder has same name as in WellKnownFolderName, then WellKnownFolderName is returned, specify full path if you need to find such custom folder.
// 2) Attempt to find folder with a given path, starting with any symbol that is treated as a delimiter, followed by WellKnownFolderName, then any folder hierarchy.
//    Examples: "/Inbox/MyFolder/SubFolder" or if folder name contains slashes, then use different delimiter that does not exist in any folder names "#Inbox#My/folder/with/slashes#Another folder"
// 	  Limitations: path can not contain two WellKnownFolderNames, start path with the last WellKnownFolderName. "/Root/Inbox/MyFolder" won't work, use "/Inbox/MyFolder" instead.
static FolderId SearchFolderByName(ExchangeService service, string path)
{
	FolderId SearchFolderId = WellKnownFolderName.Root;
	if (WellKnownFolderNameDict.ContainsKey(path)) {
		return WellKnownFolderNameDict[path];
	} else {
		FolderView fview = new FolderView(1);
		fview.Traversal = FolderTraversal.Deep;
		SearchFilter filter = new SearchFilter.IsEqualTo(FolderSchema.DisplayName, path);
		FindFoldersResults results = service.FindFolders(SearchFolderId, filter, fview);
		if (results.TotalCount == 1) {
			return results.Folders[0].Id;
		} else {
			string[] folders = path.Substring(1).Split(path.ToCharArray()[0]);
			fview.Traversal = FolderTraversal.Shallow;
			int folderDepth = 0;
			foreach (string folder in folders) {
				folderDepth++;
				if (folderDepth == 1 && WellKnownFolderNameDict.ContainsKey(folder)) 				{
					SearchFolderId = WellKnownFolderNameDict[folder];
				} else {
					filter = new SearchFilter.IsEqualTo(FolderSchema.DisplayName, folder);
					results = service.FindFolders(SearchFolderId, filter, fview);
					if (results.TotalCount == 1) {
						SearchFolderId = results.Folders[0].Id;
					} else {
						throw new Exception("Cannot find "+folder+" folder");
					}
				}
			}
			return SearchFolderId;
		}		
	}
}

//////////////////////////////////////////////////////////////////////////////
// Convert Recipients array to string.  
static string RecipientArrayToString(EmailAddressCollection recipients, bool withNames = false) 
{
	string recipients_str = "";
	foreach (EmailAddress r in recipients) {
		if (withNames) {
			recipients_str += r.Name+" <"+r.Address+">;";
		} else {
			recipients_str += r.Address+";";		
		}
	}
	return recipients_str;
}


//////////////////////////////////////////////////////////////////////////////
// Basic Service Url check
static bool RedirectionUrlValidationCallback(string redirectionUrl) {
   bool result = false;
   Uri redirectionUri = new Uri(redirectionUrl);
   if (redirectionUri.Scheme == "https")
   {
      result = true;
   }
   return result;
}

]]></code>
  </stage>
  <stage stageid="265d67d8-45bc-4946-9325-115d47680fea" name="Clean Up" type="SubSheetInfo">
    <subsheetid>ee631c7b-bad4-4777-810d-e06dd68cea55</subsheetid>
    <narrative>
    </narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="d4da8e54-302b-4659-9612-b9d07e9a3314" name="Start" type="Start">
    <subsheetid>ee631c7b-bad4-4777-810d-e06dd68cea55</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>4586c814-8c5a-4632-a9b4-5c95c35f5c3b</onsuccess>
  </stage>
  <stage stageid="4586c814-8c5a-4632-a9b4-5c95c35f5c3b" name="End" type="End">
    <subsheetid>ee631c7b-bad4-4777-810d-e06dd68cea55</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="74cf4a9d-cc59-4c9f-94f2-3f0e216ae016" name="Init EWS" type="SubSheetInfo">
    <subsheetid>ecd50929-c3ed-4beb-912d-ca77d6acfa5c</subsheetid>
    <narrative>Initialize EWS service. When using default credentials, userEmailAddress should be supplied for service url autodiscovery. </narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="c19576b3-8bbe-4dc1-b257-111965969841" name="Start" type="Start">
    <subsheetid>ecd50929-c3ed-4beb-912d-ca77d6acfa5c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="flag" name="UseDefaultCredentials" narrative="Use default credentials. True by default." stage="UseDefaultCredentials" />
      <input type="text" name="userEmailAddress" narrative="Required when not using default credentials, optional with default credentials, but should be supplied for service url autodiscovery." stage="userEmailAddress" />
      <input type="text" name="userPassword" narrative="Required when not using default credentials, otherwise ignored." stage="userPassword" />
      <input type="text" name="ServiceUrl" narrative="Required when using default credentials without userEmailAddress." stage="ServiceUrl" />
    </inputs>
    <onsuccess>87bc90ee-9b2b-47d3-92e4-35cf8c1e2465</onsuccess>
  </stage>
  <stage stageid="9c02814c-6925-4e9d-b9af-287ac30f3940" name="End" type="End">
    <subsheetid>ecd50929-c3ed-4beb-912d-ca77d6acfa5c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="11c33ff1-b455-49ba-b6e5-e019299eb8fd" name="Note1" type="Note">
    <subsheetid>ee631c7b-bad4-4777-810d-e06dd68cea55</subsheetid>
    <narrative>Clean Up Page

This is an optional page where you might choose to perform some finalisation (or "cleanup") tasks as your business object is closed down.

The cleanup action will be called automatically immediately after closing your business object at the end of a business process.

You will not be able to call this action from a business process, nor will it be called at any other time than before the disposal of the business object.</narrative>
    <displayx>-180</displayx>
    <displayy>60</displayy>
    <displaywidth>180</displaywidth>
    <displayheight>230</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="87bc90ee-9b2b-47d3-92e4-35cf8c1e2465" name="Init" type="Code">
    <subsheetid>ecd50929-c3ed-4beb-912d-ca77d6acfa5c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="flag" name="UseDefaultCredentials" expr="[UseDefaultCredentials]" />
      <input type="text" name="userEmailAddress" expr="[userEmailAddress]" />
      <input type="text" name="userPassword" expr="[userPassword]" />
      <input type="text" name="ServiceUrl" expr="[ServiceUrl]" />
    </inputs>
    <outputs>
      <output type="text" name="Url" stage="ServiceUrl" />
    </outputs>
    <onsuccess>9c02814c-6925-4e9d-b9af-287ac30f3940</onsuccess>
    <code><![CDATA[service = new ExchangeService(getCorrectTimeZone());
service.UseDefaultCredentials = UseDefaultCredentials;
if (!UseDefaultCredentials && (userEmailAddress == "" || userPassword == "")) {
	throw new Exception("userEmailAddress and userPassword are required.");
}
if (UseDefaultCredentials) {
	if (userEmailAddress != "") {
		service.AutodiscoverUrl(userEmailAddress, RedirectionUrlValidationCallback);
	} else {
		service.Url = new Uri(ServiceUrl);
	}
} else {
	service.Credentials = new WebCredentials(userEmailAddress, userPassword);
	service.AutodiscoverUrl(userEmailAddress, RedirectionUrlValidationCallback);
}
Url = service.Url.ToString();
]]></code>
  </stage>
  <stage stageid="591fe9a0-4f01-42eb-8638-beaf7a7b517e" name="Send Mail" type="SubSheetInfo">
    <subsheetid>cfd207ec-87c8-44e7-b2c5-a2e12a6a5c2f</subsheetid>
    <narrative>Send new mail.</narrative>
    <displayx>-195</displayx>
    <displayy>-120</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="a4946645-d801-4a3b-b48a-74ed21c51329" name="Start" type="Start">
    <subsheetid>cfd207ec-87c8-44e7-b2c5-a2e12a6a5c2f</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="To" narrative="Recipient list" stage="To" />
      <input type="text" name="CC" narrative="CC list" stage="CC" />
      <input type="text" name="BCC" narrative="BCC list" stage="BCC" />
      <input type="text" name="Subject" narrative="Subject" stage="Subject" />
      <input type="text" name="Message" narrative="Message to send" stage="Message" />
      <input type="flag" name="isHTML" narrative="Optional: False is default" stage="isHTML" />
      <input type="text" name="Attachments" narrative="Optional: Attachment list" stage="Attachments" />
      <input type="flag" name="SaveSent" narrative="Optional: Save mail in Sent folder? False is default" stage="SaveSent" />
    </inputs>
    <onsuccess>163c33c4-432d-4539-aac2-8b216c51b2db</onsuccess>
  </stage>
  <stage stageid="5a3a4d77-e1e6-48d3-9bc1-057176fd3f6c" name="End" type="End">
    <subsheetid>cfd207ec-87c8-44e7-b2c5-a2e12a6a5c2f</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="Success" narrative="Success flag" stage="Success" />
      <output type="text" name="Error_Message" narrative="Error message" stage="Error_Message" />
    </outputs>
  </stage>
  <stage stageid="163c33c4-432d-4539-aac2-8b216c51b2db" name="SendMail" type="Code">
    <subsheetid>cfd207ec-87c8-44e7-b2c5-a2e12a6a5c2f</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="To" expr="[To]" />
      <input type="text" name="CC" expr="[CC]" />
      <input type="text" name="BCC" expr="[BCC]" />
      <input type="text" name="Subject" expr="[Subject]" />
      <input type="text" name="Message" expr="[Message]" />
      <input type="flag" name="isHTML" expr="[isHTML]" />
      <input type="text" name="Attachments" expr="[Attachments]" />
      <input type="flag" name="SaveSent" expr="[SaveSent]" />
    </inputs>
    <outputs>
      <output type="flag" name="Success" stage="Success" />
      <output type="text" name="Error_Message" stage="Error_Message" />
    </outputs>
    <onsuccess>5a3a4d77-e1e6-48d3-9bc1-057176fd3f6c</onsuccess>
    <code><![CDATA[Success = true;
Error_Message = "";
try {
	if (To == "" && CC == "" && BCC == "") {
		throw new Exception("Recipients was not provided");
	}
	EmailMessage email = new EmailMessage(service);
	email.Subject = Subject;
	if (isHTML) {
		email.Body = new MessageBody(BodyType.HTML, Message);
	} else {
		email.Body = new MessageBody(BodyType.Text, Message);
	}
	char[] splitComma =  new char[]{','};
	char[] splitAsterisk =  new char[]{'*'};
	char[] splitSemicolon =  new char[]{';'};
	char[] splitAny =  new char[]{',',';'};

	//To
	foreach (String r in To.Split(splitAny, StringSplitOptions.RemoveEmptyEntries))
	{
		email.ToRecipients.Add(r);
	}
	//CC
	foreach (String r in CC.Split(splitAny, StringSplitOptions.RemoveEmptyEntries)) 
	{
		email.CcRecipients.Add(r);
	}
	//BCC
	foreach (String r in BCC.Split(splitAny, StringSplitOptions.RemoveEmptyEntries)) 
	{
		email.BccRecipients.Add(r);
	}

	// Add attachments
	foreach (String att in Attachments.Split(splitSemicolon, StringSplitOptions.RemoveEmptyEntries)) 
	{
		if (att.Contains(new string(splitAsterisk))) {
			String[] attArray = att.Split(splitAsterisk, StringSplitOptions.RemoveEmptyEntries);
			FileAttachment fileatt = email.Attachments.AddFileAttachment(attArray[0]);
			fileatt.IsInline = true;
			fileatt.ContentId = attArray[1];
		} else {
			email.Attachments.AddFileAttachment(att);
		}
	}		
	
	//Send
	if (SaveSent) 
	{
		email.SendAndSaveCopy();
	} else {
		email.Send();
	}
}
catch (Exception e) 
{
	Success = false;
	Error_Message = e.ToString();
}]]></code>
  </stage>
  <stage stageid="4b9ee87b-c8d4-4be2-a0cf-be5b82d9d663" name="UseDefaultCredentials" type="Data">
    <subsheetid>ecd50929-c3ed-4beb-912d-ca77d6acfa5c</subsheetid>
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>True</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="5ebceab3-bf7f-4cb6-928d-5c355bf9c6c2" name="userEmailAddress" type="Data">
    <subsheetid>ecd50929-c3ed-4beb-912d-ca77d6acfa5c</subsheetid>
    <narrative>
    </narrative>
    <displayx>75</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="465e9dd7-8f8a-49e1-82ad-afc181fb9e67" name="userPassword" type="Data">
    <subsheetid>ecd50929-c3ed-4beb-912d-ca77d6acfa5c</subsheetid>
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="9d1b7b54-b3fa-4963-9e67-986c180ccd2f" name="ServiceUrl" type="Data">
    <subsheetid>ecd50929-c3ed-4beb-912d-ca77d6acfa5c</subsheetid>
    <narrative>ServiceUrl is most likely the same for all users. You can use email/password once to find out correct one, put it here, then use default credentials without anything else.

ServiceUrl will be autodiscovered with default credentials if you set valid email (without password).</narrative>
    <displayx>195</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue xml:space="preserve">https://example.com/ews/exchange.asmx</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="99f1cfe2-fd09-4ea9-8904-553fa09b3cca" name="Success" type="Data">
    <subsheetid>cfd207ec-87c8-44e7-b2c5-a2e12a6a5c2f</subsheetid>
    <narrative>
    </narrative>
    <displayx>-210</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>False</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="6e20ccc0-4bda-459a-94e2-dca62aea3eaa" name="Error_Message" type="Data">
    <subsheetid>cfd207ec-87c8-44e7-b2c5-a2e12a6a5c2f</subsheetid>
    <narrative>
    </narrative>
    <displayx>-150</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="53c943e4-61c4-4479-b6b4-2bef18538cb0" name="SaveSent" type="Data">
    <subsheetid>cfd207ec-87c8-44e7-b2c5-a2e12a6a5c2f</subsheetid>
    <narrative>
    </narrative>
    <displayx>105</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>True</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="cb9235b0-8a0a-4f1d-85d3-b4ce43f4db31" name="Attachments" type="Data">
    <subsheetid>cfd207ec-87c8-44e7-b2c5-a2e12a6a5c2f</subsheetid>
    <narrative>
    </narrative>
    <displayx>45</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="38dd92f2-e87d-42b6-b37e-150b640d87fe" name="isHTML" type="Data">
    <subsheetid>cfd207ec-87c8-44e7-b2c5-a2e12a6a5c2f</subsheetid>
    <narrative>
    </narrative>
    <displayx>165</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>False</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="b17c1aaa-1ff2-412c-8e81-116beae949df" name="Message" type="Data">
    <subsheetid>cfd207ec-87c8-44e7-b2c5-a2e12a6a5c2f</subsheetid>
    <narrative>
    </narrative>
    <displayx>105</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="2eb0ec69-108c-4980-8093-ddfd49f4e70c" name="Subject" type="Data">
    <subsheetid>cfd207ec-87c8-44e7-b2c5-a2e12a6a5c2f</subsheetid>
    <narrative>
    </narrative>
    <displayx>45</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="a0bdfbcb-af36-4010-9ca5-ffbcbb5ccb61" name="BCC" type="Data">
    <subsheetid>cfd207ec-87c8-44e7-b2c5-a2e12a6a5c2f</subsheetid>
    <narrative>
    </narrative>
    <displayx>165</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="16f3284b-8082-4c0a-aff8-8f1253d930ca" name="CC" type="Data">
    <subsheetid>cfd207ec-87c8-44e7-b2c5-a2e12a6a5c2f</subsheetid>
    <narrative>
    </narrative>
    <displayx>105</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="81dc9c37-f5be-40e9-b836-9eb505257e82" name="To" type="Data">
    <subsheetid>cfd207ec-87c8-44e7-b2c5-a2e12a6a5c2f</subsheetid>
    <narrative>
    </narrative>
    <displayx>45</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="13e21552-aebe-4778-9615-8190f1339314" name="Init EWS Default" type="SubSheet">
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-195</displayx>
    <displayy>-180</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="flag" name="UseDefaultCredentials" narrative="Use default credentials. True by default." expr="True" />
      <input type="text" name="userEmailAddress" narrative="Required when not using default credentials, optional with default credentials, but should be supplied for service url autodiscovery." expr="" />
      <input type="text" name="userPassword" narrative="Required when not using default credentials, otherwise ignored." expr="" />
      <input type="text" name="ServiceUrl" narrative="Required when using default credentials without userEmailAddress." expr="" />
    </inputs>
    <onsuccess>d062cb7b-bd38-4e7b-b32c-7c090b15ed2a</onsuccess>
    <processid>ecd50929-c3ed-4beb-912d-ca77d6acfa5c</processid>
  </stage>
  <stage stageid="938d5a91-67cd-4b23-9a9e-c110e564979a" name="Init Note" type="Note">
    <loginhibit />
    <narrative>Init with default parameters.
Remove this if default credentials wont work for you.</narrative>
    <displayx>-60</displayx>
    <displayy>-180</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>60</displayheight>
    <font family="Segoe UI" size="10" style="Bold" color="FF0000" />
    <onsuccess>13e21552-aebe-4778-9615-8190f1339314</onsuccess>
  </stage>
  <stage stageid="9723ca01-bdb0-495a-a4bf-b28b8d1b2fe6" name="Get mail list" type="SubSheetInfo">
    <subsheetid>edb81c89-db1e-447e-8544-811f39c2499a</subsheetid>
    <narrative>
    </narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="ddd3c543-f872-4d28-98f4-bd9e47e80a7d" name="Start" type="Start">
    <subsheetid>edb81c89-db1e-447e-8544-811f39c2499a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="number" name="pageSize" narrative="Result set size. Default is 50." stage="pageSize" />
      <input type="number" name="offset" narrative="Offset from the start of the results. Default is 0" stage="offset" />
      <input type="text" name="folderName" narrative="Folder name. Default is &quot;Inbox&quot;" stage="folderName" />
      <input type="text" name="searchFilter" narrative="AQS search filter string." stage="searchFilter" />
    </inputs>
    <onsuccess>d9c7489e-3cb9-4719-8f09-2aa36287a2d7</onsuccess>
  </stage>
  <stage stageid="be893797-5862-4be7-87ff-6c31981f1573" name="End" type="End">
    <subsheetid>edb81c89-db1e-447e-8544-811f39c2499a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>60</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="d9c7489e-3cb9-4719-8f09-2aa36287a2d7" name="Init EWS" type="SubSheet">
    <subsheetid>edb81c89-db1e-447e-8544-811f39c2499a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="flag" name="UseDefaultCredentials" narrative="Use default credentials. True by default." expr="True" />
      <input type="text" name="userEmailAddress" narrative="Required when not using default credentials, optional with default credentials, but should be supplied for service url autodiscovery." expr="&quot;user@example.com&quot;" />
      <input type="text" name="userPassword" narrative="Required when not using default credentials, otherwise ignored." expr="" />
      <input type="text" name="ServiceUrl" narrative="Required when using default credentials without userEmailAddress." expr="" />
    </inputs>
    <onsuccess>751130b2-654e-4c19-9ce9-667e19c1309c</onsuccess>
    <processid>ecd50929-c3ed-4beb-912d-ca77d6acfa5c</processid>
  </stage>
  <stage stageid="5f271102-ae21-4bd4-803b-ae4bcd5291e3" name="MoreAvailable" type="Data">
    <subsheetid>edb81c89-db1e-447e-8544-811f39c2499a</subsheetid>
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="ae9cdd82-499b-4e68-9880-b9b9f96f6f6c" name="pageSize" type="Data">
    <subsheetid>edb81c89-db1e-447e-8544-811f39c2499a</subsheetid>
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue>50</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="12816304-4197-4dcd-8ede-3f5f165d4698" name="offset" type="Data">
    <subsheetid>edb81c89-db1e-447e-8544-811f39c2499a</subsheetid>
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue>0</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d610b377-a264-47be-9164-aa728b03d89f" name="folderName" type="Data">
    <subsheetid>edb81c89-db1e-447e-8544-811f39c2499a</subsheetid>
    <narrative>
    </narrative>
    <displayx>210</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue xml:space="preserve">Inbox</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="bc0a62f5-82f2-4f7c-99df-dc8fee944a46" name="searchFilter" type="Data">
    <subsheetid>edb81c89-db1e-447e-8544-811f39c2499a</subsheetid>
    <narrative>https://docs.microsoft.com/ru-ru/exchange/client-developer/exchange-web-services/how-to-perform-an-aqs-search-by-using-ews-in-exchange
isread:false 
received:today
received:&gt;12/29/2019 received:&lt;12/31/2019</narrative>
    <displayx>270</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue xml:space="preserve">isread:false</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="27929df4-5f07-4018-bb6d-5b90aa4769af" name="Get Mail Message" type="SubSheetInfo">
    <subsheetid>6c76e60b-8270-4f91-90d0-d3772af9c368</subsheetid>
    <narrative>Get mail message by Id. </narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="54216661-3455-462d-b936-b667f03018aa" name="Start" type="Start">
    <subsheetid>6c76e60b-8270-4f91-90d0-d3772af9c368</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="number" name="Id" narrative="Message id" stage="Id" />
      <input type="flag" name="textBody" narrative="Always get body as text. False returns as is." stage="textBody" />
      <input type="flag" name="getAttachments" narrative="Get attachments in collection." stage="getAttachments" />
      <input type="text" name="saveAttachmentsPath" narrative="Path to save attachments. Empty string " stage="saveAttachmentsPath" />
    </inputs>
    <onsuccess>4166a845-392f-4f94-949d-a65c1462691e</onsuccess>
  </stage>
  <stage stageid="a859f15a-260d-46b5-840f-0400e6cdeb0b" name="End" type="End">
    <subsheetid>6c76e60b-8270-4f91-90d0-d3772af9c368</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="text" name="Id" stage="Id" />
      <output type="text" name="Subject" stage="Subject" />
      <output type="text" name="FromName" stage="FromName" />
      <output type="text" name="FromAddress" stage="FromAddress" />
      <output type="text" name="ToRecipients" stage="ToRecipients" />
      <output type="text" name="CcRecipients" stage="CcRecipients" />
      <output type="text" name="BccRecipients" stage="BccRecipients" />
      <output type="flag" name="IsRead" stage="IsRead" />
      <output type="flag" name="HasAttachments" stage="HasAttachments" />
      <output type="datetime" name="DateTimeSent" stage="DateTimeSent" />
      <output type="datetime" name="DateTimeReceived" stage="DateTimeReceived" />
      <output type="text" name="Body" stage="Body" />
      <output type="flag" name="isHTML" stage="isHTML" />
      <output type="collection" name="Attachments" stage="Attachments" />
    </outputs>
  </stage>
  <stage stageid="4166a845-392f-4f94-949d-a65c1462691e" name="GetMail" type="Code">
    <subsheetid>6c76e60b-8270-4f91-90d0-d3772af9c368</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Id" expr="[Id]" />
      <input type="flag" name="textBody" expr="[textBody]" />
      <input type="flag" name="getAttachments" expr="[getAttachments]" />
      <input type="text" name="saveAttachmentsPath" expr="[saveAttachmentsPath]" />
    </inputs>
    <outputs>
      <output type="text" name="Id_out" stage="Id" />
      <output type="text" name="Subject" stage="Subject" />
      <output type="text" name="FromName" stage="FromName" />
      <output type="text" name="FromAddress" stage="FromAddress" />
      <output type="text" name="ToRecipients" stage="ToRecipients" />
      <output type="text" name="CcRecipients" stage="CcRecipients" />
      <output type="text" name="BccRecipients" stage="BccRecipients" />
      <output type="flag" name="IsRead" stage="IsRead" />
      <output type="flag" name="HasAttachments" stage="HasAttachments" />
      <output type="datetime" name="DateTimeSent" stage="DateTimeSent" />
      <output type="datetime" name="DateTimeReceived" stage="DateTimeReceived" />
      <output type="text" name="Body" stage="Body" />
      <output type="flag" name="isHTML" stage="isHTML" />
      <output type="collection" name="Attachments" stage="Attachments" />
    </outputs>
    <onsuccess>a859f15a-260d-46b5-840f-0400e6cdeb0b</onsuccess>
    <code><![CDATA[PropertySet properties = new PropertySet(BasePropertySet.FirstClassProperties, //A PropertySet with the explicit properties you want goes here
										EmailMessageSchema.Id, 
										EmailMessageSchema.Subject, 
										EmailMessageSchema.From, 
										EmailMessageSchema.ToRecipients, 
										EmailMessageSchema.CcRecipients, 
										EmailMessageSchema.BccRecipients, 
										EmailMessageSchema.IsRead, 
										EmailMessageSchema.HasAttachments, 
										EmailMessageSchema.Body,
										//EmailMessageSchema.UniqueBody, //Only message itself, without citations.
										EmailMessageSchema.DateTimeSent, 
										EmailMessageSchema.DateTimeReceived); 

if (textBody) { 
	properties.RequestedBodyType = BodyType.Text;
	//properties.RequestedUniqueBodyType = BodyType.Text;
	//properties.RequestedNormalizedBodyType = BodyType.Text;
}

EmailMessage email = EmailMessage.Bind(service,(ItemId)Id,properties);
Id_out = email.Id.ToString(); 
try {Subject = email.Subject;} catch {Subject = "";}
try {
	FromName = email.From.Name;
	FromAddress = email.From.Address;
	} catch {FromName = ""; FromAddress = "";}
try {ToRecipients =	RecipientArrayToString(email.ToRecipients);} catch {ToRecipients = "";}
try {CcRecipients =	RecipientArrayToString(email.CcRecipients);} catch {CcRecipients = "";}
try {BccRecipients = RecipientArrayToString(email.BccRecipients);} catch {BccRecipients = "";}
try {IsRead = email.IsRead;} catch {IsRead = false;}
try {HasAttachments = email.HasAttachments;} catch {HasAttachments = false;}
try {DateTimeSent = email.DateTimeSent.ToLocalTime();} catch {DateTimeSent = new DateTime();}
try {DateTimeReceived = email.DateTimeReceived.ToLocalTime();} catch {DateTimeReceived = new DateTime();}
try {
	Body = email.Body.Text;
	isHTML = email.Body.BodyType==BodyType.HTML;
	} catch {Body = ""; isHTML = false;}
	
Attachments = new DataTable();
Attachments.Columns.Add("Type", typeof(string));
Attachments.Columns.Add("FileName", typeof(string));
Attachments.Columns.Add("Content", typeof(byte[]));
Attachments.Columns.Add("ContentType", typeof(string));
Attachments.Columns.Add("IsInline", typeof(string));
Attachments.Columns.Add("IsContactPhoto", typeof(bool));

if (email.HasAttachments){
	foreach (Attachment att in email.Attachments){
		if (att is FileAttachment)
		{ 
			FileAttachment fileAttachment = att as FileAttachment;
			if (saveAttachmentsPath != "" && Directory.Exists(saveAttachmentsPath)) 
			{
				fileAttachment.Load(Path.Combine(saveAttachmentsPath,fileAttachment.Name));
			}
			if (getAttachments)
			{
				fileAttachment.Load();
				DataRow dr = Attachments.NewRow();
				dr["Type"] = "File";
				dr["FileName"] = fileAttachment.Name;
				dr["Content"] = fileAttachment.Content;
				dr["ContentType"] = fileAttachment.ContentType;
				dr["IsInline"] = fileAttachment.IsInline;
				//dr["ContentText"] = System.Text.UTF8.GetString(fileAttachment.Content).TrimEnd('\0');
				dr["IsContactPhoto"] = fileAttachment.IsContactPhoto;
				Attachments.Rows.Add(dr);		
			}
		}
		else if (att is ItemAttachment)
		{ 
			ItemAttachment itemAttachment = att as ItemAttachment;
			if (saveAttachmentsPath != "" && Directory.Exists(saveAttachmentsPath)) 
			{
					itemAttachment.Load(EmailMessageSchema.MimeContent);
					File.WriteAllBytes(Path.Combine(saveAttachmentsPath,itemAttachment.Item.Subject+".eml"), itemAttachment.Item.MimeContent.Content);
			}
			if (getAttachments)
			{
				itemAttachment.Load(EmailMessageSchema.MimeContent);
				DataRow dr = Attachments.NewRow();
				dr["Type"] = "Item";
				dr["FileName"] = itemAttachment.Item.Subject;
				dr["Content"] = itemAttachment.Item.MimeContent.Content;
				dr["ContentType"] = itemAttachment.ContentType;
				dr["IsInline"] = itemAttachment.IsInline;
				dr["IsContactPhoto"] = false;
				Attachments.Rows.Add(dr);	
			}
		}
	}
}]]></code>
  </stage>
  <stage stageid="5683d064-8b96-4eec-8761-97de504f07d5" name="Id" type="Data">
    <subsheetid>6c76e60b-8270-4f91-90d0-d3772af9c368</subsheetid>
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="751130b2-654e-4c19-9ce9-667e19c1309c" name="Get Mail List" type="SubSheet">
    <subsheetid>edb81c89-db1e-447e-8544-811f39c2499a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="number" name="pageSize" narrative="Result set size. Default is 50." expr="[pageSize]" />
      <input type="number" name="offset" narrative="Offset from the start of the results. Default is 0" expr="[offset]" />
      <input type="text" name="folderName" narrative="Optional: Folder name. Default is &quot;Inbox&quot;" expr="[folderName]" />
      <input type="collection" name="MessageView" narrative="Optional: Message View to append data" expr="[MessageView]" />
      <input type="text" name="subjectFilter" narrative="Optional: Subject search filter" expr="" />
      <input type="text" name="senderFilter" narrative="Optional: Sender search filter" expr="" />
      <input type="flag" name="unreadOnly" narrative="Optional: Return only Unread mail" expr="" />
      <input type="flag" name="sortDateReceivedAscending" narrative="Optional: Older first?" expr="" />
      <input type="date" name="dateFrom" narrative="Optional: Received date from" expr="" />
      <input type="date" name="dateTo" narrative="Optional: Received date to" expr="" />
    </inputs>
    <outputs>
      <output type="collection" name="MessageView" stage="MessageView" />
      <output type="flag" name="MoreAvailable" stage="MoreAvailable" />
    </outputs>
    <onsuccess>a36e0bbc-ddff-463e-8d3c-23efcc72ce12</onsuccess>
    <processid>b48f8483-0de2-4ce2-8fe0-3cea3f83da30</processid>
  </stage>
  <stage stageid="a50e33c0-990a-4ec3-8942-33e1f07cda29" name="Subject" type="Data">
    <subsheetid>6c76e60b-8270-4f91-90d0-d3772af9c368</subsheetid>
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="4c986dfb-f3a6-4538-a371-8a11dabdcc2a" name="FromName" type="Data">
    <subsheetid>6c76e60b-8270-4f91-90d0-d3772af9c368</subsheetid>
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="2f2164ff-20a1-41d2-8b73-3d109a50edaa" name="FromAddress" type="Data">
    <subsheetid>6c76e60b-8270-4f91-90d0-d3772af9c368</subsheetid>
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="6a809784-2481-4d50-a981-62b2a845dcf8" name="IsRead" type="Data">
    <subsheetid>6c76e60b-8270-4f91-90d0-d3772af9c368</subsheetid>
    <narrative>
    </narrative>
    <displayx>210</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="7108233d-d40b-4dfa-b5b9-2213cc10ee92" name="HasAttachments" type="Data">
    <subsheetid>6c76e60b-8270-4f91-90d0-d3772af9c368</subsheetid>
    <narrative>
    </narrative>
    <displayx>270</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="ca5e3706-561a-41bc-a760-cabbb4bf2a00" name="DateTimeSent" type="Data">
    <subsheetid>6c76e60b-8270-4f91-90d0-d3772af9c368</subsheetid>
    <narrative>
    </narrative>
    <displayx>330</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>datetime</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="db86dde5-6f35-43f7-9501-b8c87e61b739" name="DateTimeReceived" type="Data">
    <subsheetid>6c76e60b-8270-4f91-90d0-d3772af9c368</subsheetid>
    <narrative>
    </narrative>
    <displayx>390</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>datetime</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="041d45ae-aaa9-421c-8fd7-157ce92ef3be" name="Body" type="Data">
    <subsheetid>6c76e60b-8270-4f91-90d0-d3772af9c368</subsheetid>
    <narrative>
    </narrative>
    <displayx>210</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="14cf3cd8-9bb6-44bf-b7c4-a08fdc9dc514" name="isHTML" type="Data">
    <subsheetid>6c76e60b-8270-4f91-90d0-d3772af9c368</subsheetid>
    <narrative>
    </narrative>
    <displayx>270</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d556a88a-015f-4ad3-abff-b86e7c826ff1" name="mail.isRead" type="SubSheetInfo">
    <subsheetid>b024d2ea-8736-49c2-997b-6077e372fe79</subsheetid>
    <narrative>Mark message as Read/Unread by Id.</narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="cc0cedca-110a-4931-a04e-514443a54f22" name="Start" type="Start">
    <subsheetid>b024d2ea-8736-49c2-997b-6077e372fe79</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Id" narrative="Message id" stage="Id" />
      <input type="flag" name="isRead" narrative="isRead" stage="isRead" />
      <input type="flag" name="suppressReadReceipts" narrative="suppressReadReceipts" stage="suppressReadReceipts" />
    </inputs>
    <onsuccess>b28ecb42-2af0-496b-92d4-0ca6fef9a81e</onsuccess>
  </stage>
  <stage stageid="6196d9ec-1e63-4406-8d37-1d5880bac278" name="End" type="End">
    <subsheetid>b024d2ea-8736-49c2-997b-6077e372fe79</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="b28ecb42-2af0-496b-92d4-0ca6fef9a81e" name="MarkRead" type="Code">
    <subsheetid>b024d2ea-8736-49c2-997b-6077e372fe79</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Id" expr="[Id]" />
      <input type="flag" name="isRead" expr="[isRead]" />
      <input type="flag" name="suppressReadReceipts" expr="[suppressReadReceipts]" />
    </inputs>
    <outputs>
      <output type="flag" name="success" stage="Success" />
      <output type="text" name="exception" stage="Exception" />
    </outputs>
    <onsuccess>6196d9ec-1e63-4406-8d37-1d5880bac278</onsuccess>
    <code><![CDATA[try
{
	EmailMessage email = EmailMessage.Bind(service,(ItemId)Id);
	email.IsRead = isRead;
	email.Update(ConflictResolutionMode.AlwaysOverwrite,suppressReadReceipts);                
	success = true;
	exception = "";
}
catch (Exception e)
{
    success = false;
	exception = e.Message;
}
]]></code>
  </stage>
  <stage stageid="32d3f5eb-9b4d-4b2b-acf9-e64d24251de3" name="Id" type="Data">
    <subsheetid>b024d2ea-8736-49c2-997b-6077e372fe79</subsheetid>
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="21f683ad-464f-478f-aebb-533b2c840bfd" name="Exception" type="Data">
    <subsheetid>b024d2ea-8736-49c2-997b-6077e372fe79</subsheetid>
    <narrative>
    </narrative>
    <displayx>75</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="c4541616-4d7d-4d3d-956c-9e40b92e2164" name="Success" type="Data">
    <subsheetid>b024d2ea-8736-49c2-997b-6077e372fe79</subsheetid>
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>False</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="9c2f5079-dfac-4172-8a7f-48bff57d5a03" name="isRead" type="Data">
    <subsheetid>b024d2ea-8736-49c2-997b-6077e372fe79</subsheetid>
    <narrative>
    </narrative>
    <displayx>75</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>True</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d8cd561e-3edc-4349-80bf-cb803ece716e" name="Attachments" type="Collection">
    <subsheetid>6c76e60b-8270-4f91-90d0-d3772af9c368</subsheetid>
    <narrative>
    </narrative>
    <displayx>330</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>collection</datatype>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="28886894-9023-48d7-b104-31aad3ca6f65" name="saveAttachmentsPath" type="Data">
    <subsheetid>6c76e60b-8270-4f91-90d0-d3772af9c368</subsheetid>
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="f86a6315-f0d9-4f51-bfe4-ef6cc18f549f" name="getAttachments" type="Data">
    <subsheetid>6c76e60b-8270-4f91-90d0-d3772af9c368</subsheetid>
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>False</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="64f3bb7f-131b-43c8-9aba-7ad0ee2e8820" name="Get Appointment List" type="SubSheetInfo">
    <subsheetid>006d2192-6cd3-44fb-ad13-15130026e046</subsheetid>
    <narrative>WIP appointments</narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="4d50556c-5dfe-4691-b77c-0e78222ff0c7" name="Start" type="Start">
    <subsheetid>006d2192-6cd3-44fb-ad13-15130026e046</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="number" name="pageSize" narrative="Result set size. Default is 50." stage="pageSize" />
      <input type="number" name="offset" narrative="Offset from the start of the results. Default is 0" stage="offset" />
      <input type="text" name="folderName" narrative="Folder name. Default is &quot;Inbox&quot;" stage="folderName" />
      <input type="text" name="searchFilter" narrative="AQS search filter string." stage="searchFilter" />
    </inputs>
    <onsuccess>e1c66ead-9f7d-4d81-88c9-724a0a3bf4ae</onsuccess>
  </stage>
  <stage stageid="b086c9a9-75a0-4c9f-adf2-303b23bf8a78" name="End" type="End">
    <subsheetid>006d2192-6cd3-44fb-ad13-15130026e046</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="collection" name="ApptView" stage="ApptView" />
      <output type="flag" name="MoreAvailable" stage="MoreAvailable" />
    </outputs>
  </stage>
  <stage stageid="e1c66ead-9f7d-4d81-88c9-724a0a3bf4ae" name="GetApptList" type="Code">
    <subsheetid>006d2192-6cd3-44fb-ad13-15130026e046</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="number" name="pageSize" expr="[pageSize]" />
      <input type="number" name="offset" expr="[offset]" />
      <input type="text" name="folderName" expr="[folderName]" />
      <input type="text" name="searchFilter" expr="[searchFilter]" />
    </inputs>
    <outputs>
      <output type="collection" name="ApptView" stage="ApptView" />
      <output type="flag" name="MoreAvailable" stage="MoreAvailable" />
    </outputs>
    <onsuccess>b086c9a9-75a0-4c9f-adf2-303b23bf8a78</onsuccess>
    <code><![CDATA[// Create DT
ApptView = new DataTable();
ApptView.Columns.Add("Id", typeof(string));
ApptView.Columns.Add("Subject", typeof(string));
ApptView.Columns.Add("HasAttachments", typeof(bool));
ApptView.Columns.Add("DateTimeSent", typeof(DateTime));
ApptView.Columns.Add("DateTimeReceived", typeof(DateTime));

// Mail
ItemView view = new ItemView((int)pageSize, (int)offset, OffsetBasePoint.Beginning);

view.PropertySet = PropertySet.IdOnly;
FindItemsResults<Item> findResults;
List<EmailMessage> emails = new List<EmailMessage>();

FolderId SearchFolderId = SearchFolderByName(service,folderName);
findResults = service.FindItems(SearchFolderId, searchFilter, view);

MoreAvailable = findResults.MoreAvailable;

if (findResults.TotalCount > 0) {
	PropertySet properties = new PropertySet(BasePropertySet.FirstClassProperties, //A PropertySet with the explicit properties you want goes here
											EmailMessageSchema.Id, 
											EmailMessageSchema.Subject, 
											//EmailMessageSchema.From, 
											//EmailMessageSchema.ToRecipients, 
											//EmailMessageSchema.CcRecipients, 
											//EmailMessageSchema.BccRecipients, 
											//EmailMessageSchema.IsRead, 
											EmailMessageSchema.HasAttachments, 
											EmailMessageSchema.DateTimeSent, 
											EmailMessageSchema.DateTimeReceived); 
	//properties.RequestedBodyType = BodyType.Text;
	//properties.RequestedUniqueBodyType = BodyType.Text;
	//properties.RequestedNormalizedBodyType = BodyType.Text;
	service.LoadPropertiesForItems(findResults.Items, properties);

	//Fill DT
	foreach (Appointment appt in findResults.Items.Where(i => i is Appointment))
	{
		DataRow dr = ApptView.NewRow();
		dr["Id"] = appt.Id.ToString();
		try {dr["Subject"] = appt.Subject;}catch {}
		try {dr["HasAttachments"] = appt.HasAttachments;} catch {}
		try {dr["DateTimeSent"] = appt.DateTimeSent;} catch {}
		try {dr["DateTimeReceived"] = appt.DateTimeReceived;} catch {}
		
		ApptView.Rows.Add(dr);
	}
}]]></code>
  </stage>
  <stage stageid="7f88f162-dc76-4d4f-a035-f1d9ef770d55" name="MoreAvailable" type="Data">
    <subsheetid>006d2192-6cd3-44fb-ad13-15130026e046</subsheetid>
    <narrative>
    </narrative>
    <displayx>75</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>False</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="cb4a95f6-b0a0-468b-8bba-fb10982c49f9" name="pageSize" type="Data">
    <subsheetid>006d2192-6cd3-44fb-ad13-15130026e046</subsheetid>
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue>50</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="12b2c21f-46ca-4d48-a827-8adf2d43f676" name="offset" type="Data">
    <subsheetid>006d2192-6cd3-44fb-ad13-15130026e046</subsheetid>
    <narrative>
    </narrative>
    <displayx>75</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue>0</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="efaa491c-7c44-44d1-b315-770758607bcb" name="folderName" type="Data">
    <subsheetid>006d2192-6cd3-44fb-ad13-15130026e046</subsheetid>
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue xml:space="preserve">Inbox</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="164f4171-2974-4345-90a3-8ebba0f9f2a3" name="searchFilter" type="Data">
    <subsheetid>006d2192-6cd3-44fb-ad13-15130026e046</subsheetid>
    <narrative>Basically just like outlook search works.
https://docs.microsoft.com/ru-ru/exchange/client-developer/exchange-web-services/how-to-perform-an-aqs-search-by-using-ews-in-exchange
Examples:
isread:false 
received:today
received:&gt;12/29/2019 received:&lt;12/31/2019</narrative>
    <displayx>195</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="70d74201-c0ee-44ba-a004-e68498abd42c" name="ApptView" type="Collection">
    <subsheetid>006d2192-6cd3-44fb-ad13-15130026e046</subsheetid>
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>collection</datatype>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="2b2edd67-6024-4db8-a446-70b354ef9fb7" name="BccRecipients" type="Data">
    <subsheetid>6c76e60b-8270-4f91-90d0-d3772af9c368</subsheetid>
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="9bad9c9d-102d-4fee-a13a-620da5b2c0cd" name="CcRecipients" type="Data">
    <subsheetid>6c76e60b-8270-4f91-90d0-d3772af9c368</subsheetid>
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="1bf7ca8e-e75e-4ad2-9a0a-54293652087d" name="ToRecipients" type="Data">
    <subsheetid>6c76e60b-8270-4f91-90d0-d3772af9c368</subsheetid>
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="5e1c3ae5-c7e0-4a27-b938-965077277a60" name="textBody" type="Data">
    <subsheetid>6c76e60b-8270-4f91-90d0-d3772af9c368</subsheetid>
    <narrative>
    </narrative>
    <displayx>210</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>True</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d8e387d0-e23b-4569-9da0-259f6ef6774c" name="Reply Mail" type="SubSheetInfo">
    <subsheetid>41708016-914c-4bc9-aba4-3776db6744d5</subsheetid>
    <narrative>Reply mail. Use Get Mail List action to find Id.</narrative>
    <displayx>-195</displayx>
    <displayy>-120</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="07ea1532-c5a2-4940-9d84-52bae15d1fd0" name="Start" type="Start">
    <subsheetid>41708016-914c-4bc9-aba4-3776db6744d5</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Id" narrative="Message Id to reply to" stage="Id" />
      <input type="flag" name="replyToAll" narrative="Reply to all" stage="replyToAll" />
      <input type="text" name="ToRecipients" narrative="To recipients to add" stage="To" />
      <input type="text" name="CcRecipients" narrative="Cc recipients to add" stage="CC" />
      <input type="text" name="BccRecipients" narrative="Bcc recipients to add" stage="BCC" />
      <input type="text" name="resposeMessage" narrative="Message to send" stage="resposeMessage" />
      <input type="flag" name="isHTML" narrative="Optional: False is default" stage="isHTML" />
      <input type="text" name="Attachments" narrative="Optional: Attachment list" stage="Attachments" />
      <input type="flag" name="SaveSent" narrative="Optional: Save mail in Sent folder? False is default" stage="SaveSent" />
      <input type="flag" name="KeepOriginalMessage" narrative="Optional: Keep original message?" stage="KeepOriginalMessage" />
    </inputs>
    <onsuccess>dedfd254-305a-48cc-bed3-e6ab8feffd4b</onsuccess>
  </stage>
  <stage stageid="adc33316-e302-4aab-bf7c-6ce69f2ffb2d" name="End" type="End">
    <subsheetid>41708016-914c-4bc9-aba4-3776db6744d5</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="Success" narrative="Success flag" stage="Success" />
      <output type="text" name="Error_Message" narrative="Error message" stage="Error_Message" />
    </outputs>
  </stage>
  <stage stageid="dedfd254-305a-48cc-bed3-e6ab8feffd4b" name="ReplyMail" type="Code">
    <subsheetid>41708016-914c-4bc9-aba4-3776db6744d5</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Id" expr="[Id]" />
      <input type="flag" name="replyToAll" expr="[replyToAll]" />
      <input type="text" name="To" expr="[To]" />
      <input type="text" name="CC" expr="[CC]" />
      <input type="text" name="BCC" expr="[BCC]" />
      <input type="text" name="resposeMessage" expr="[resposeMessage]" />
      <input type="flag" name="isHTML" expr="[isHTML]" />
      <input type="text" name="Attachments" expr="[Attachments]" />
      <input type="flag" name="SaveSent" expr="[SaveSent]" />
      <input type="flag" name="KeepOriginalMessage" expr="[KeepOriginalMessage]" />
    </inputs>
    <outputs>
      <output type="flag" name="Success" stage="Success" />
      <output type="text" name="Error_Message" stage="Error_Message" />
    </outputs>
    <onsuccess>adc33316-e302-4aab-bf7c-6ce69f2ffb2d</onsuccess>
    <code><![CDATA[Success = true;
Error_Message = "";
try {
	EmailMessage messageToReplyTo = EmailMessage.Bind(service,(ItemId)Id);
	ResponseMessage responseMessage = messageToReplyTo.CreateReply(replyToAll);
	if (isHTML) {
		if (!KeepOriginalMessage) responseMessage.Body = new MessageBody(BodyType.HTML, "");
		responseMessage.BodyPrefix = new MessageBody(BodyType.HTML, resposeMessage);
	} else {
		if (!KeepOriginalMessage) responseMessage.Body = new MessageBody(BodyType.Text, "");
		responseMessage.BodyPrefix = new MessageBody(BodyType.Text, resposeMessage);
	}
	char[] splitComma =  new char[]{','};
	char[] splitAsterisk =  new char[]{'*'};
	char[] splitSemicolon =  new char[]{';'};
	char[] splitAny =  new char[]{',',';'};

	//To
	foreach (String r in To.Split(splitAny, StringSplitOptions.RemoveEmptyEntries))
	{
		responseMessage.ToRecipients.Add(r);
	}
	//CC
	foreach (String r in CC.Split(splitAny, StringSplitOptions.RemoveEmptyEntries)) 
	{
		responseMessage.CcRecipients.Add(r);
	}
	//BCC
	foreach (String r in BCC.Split(splitAny, StringSplitOptions.RemoveEmptyEntries)) 
	{
		responseMessage.BccRecipients.Add(r);
	}

	// We need to save message to add attachments
    EmailMessage responseMessageDraft = responseMessage.Save();
	
	// Add attachments
	foreach (String att in Attachments.Split(splitSemicolon, StringSplitOptions.RemoveEmptyEntries)) 
	{
		if (att.Contains(new string(splitAsterisk))) {
			String[] attArray = att.Split(splitAsterisk, StringSplitOptions.RemoveEmptyEntries);
			FileAttachment fileatt = responseMessageDraft.Attachments.AddFileAttachment(attArray[0]);
			fileatt.IsInline = true;
			fileatt.ContentId = attArray[1];
		} else {
			responseMessageDraft.Attachments.AddFileAttachment(att);
		}
	}		
	
	
	// AutoResolve should not be an issue, we are sending it right away.
	responseMessageDraft.Update(ConflictResolutionMode.AutoResolve);
	
	//Send
	if (SaveSent) 
	{
		responseMessageDraft.SendAndSaveCopy();
	} else {
		responseMessageDraft.Send();
	}
}
catch (Exception e) 
{
	Success = false;
	Error_Message = e.ToString();
}]]></code>
  </stage>
  <stage stageid="41d2c1a2-050f-439f-9388-9a93107720e8" name="Success" type="Data">
    <subsheetid>41708016-914c-4bc9-aba4-3776db6744d5</subsheetid>
    <narrative>
    </narrative>
    <displayx>-210</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>False</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="a7182244-fd1d-4d61-a6d3-9a2ec7c596e1" name="Error_Message" type="Data">
    <subsheetid>41708016-914c-4bc9-aba4-3776db6744d5</subsheetid>
    <narrative>
    </narrative>
    <displayx>-150</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="380c0c22-2658-4045-a1f6-ab4316905bee" name="SaveSent" type="Data">
    <subsheetid>41708016-914c-4bc9-aba4-3776db6744d5</subsheetid>
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>True</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="febb6cd3-b188-418e-b669-2f48730fc176" name="Attachments" type="Data">
    <subsheetid>41708016-914c-4bc9-aba4-3776db6744d5</subsheetid>
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="7d21f101-bdba-40da-9e92-ade3489c4479" name="isHTML" type="Data">
    <subsheetid>41708016-914c-4bc9-aba4-3776db6744d5</subsheetid>
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>False</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d833bd9f-fe81-4227-b407-4e999e18a2c5" name="Id" type="Data">
    <subsheetid>41708016-914c-4bc9-aba4-3776db6744d5</subsheetid>
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="5c085946-aeba-4313-a890-b94a31c9de6c" name="replyToAll" type="Data">
    <subsheetid>41708016-914c-4bc9-aba4-3776db6744d5</subsheetid>
    <narrative>
    </narrative>
    <displayx>75</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>False</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="37025626-09e6-4b92-8238-22d3de3ffcbb" name="resposeMessage" type="Data">
    <subsheetid>41708016-914c-4bc9-aba4-3776db6744d5</subsheetid>
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="227a5fb9-7fe8-40e9-a389-5345c31887ab" name="BCC" type="Data">
    <subsheetid>41708016-914c-4bc9-aba4-3776db6744d5</subsheetid>
    <narrative>
    </narrative>
    <displayx>255</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="cfe4609c-087a-4251-88fa-42639e186ecc" name="CC" type="Data">
    <subsheetid>41708016-914c-4bc9-aba4-3776db6744d5</subsheetid>
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d64a1ce6-30b7-4f72-b139-b5b425eb045e" name="To" type="Data">
    <subsheetid>41708016-914c-4bc9-aba4-3776db6744d5</subsheetid>
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="a36e0bbc-ddff-463e-8d3c-23efcc72ce12" name="Send Mail" type="SubSheet">
    <subsheetid>edb81c89-db1e-447e-8544-811f39c2499a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>0</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="To" narrative="Recipient list" expr="&quot;&quot;" />
      <input type="text" name="CC" narrative="CC list" expr="&quot;&quot;" />
      <input type="text" name="BCC" narrative="BCC list" expr="&quot;&quot;" />
      <input type="text" name="Subject" narrative="Subject" expr="&quot;EWS API test&quot;" />
      <input type="text" name="Message" narrative="Message to send" expr="&quot;EWS API test&quot;" />
      <input type="flag" name="isHTML" narrative="Optional: False is default" expr="False" />
      <input type="text" name="Attachments" narrative="Optional: Attachment list" expr="&quot;&quot;" />
      <input type="flag" name="SaveSent" narrative="Optional: Save mail in Sent folder? False is default" expr="False" />
    </inputs>
    <outputs>
      <output type="flag" name="Success" narrative="Success flag" stage="Success" />
      <output type="text" name="Error_Message" narrative="Error message" stage="Error_Message" />
    </outputs>
    <onsuccess>be893797-5862-4be7-87ff-6c31981f1573</onsuccess>
    <processid>cfd207ec-87c8-44e7-b2c5-a2e12a6a5c2f</processid>
  </stage>
  <stage stageid="d8ed8e24-acf6-4973-88eb-aa0df5f933c0" name="Success" type="Data">
    <subsheetid>edb81c89-db1e-447e-8544-811f39c2499a</subsheetid>
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>0</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="37fc5bff-ebf8-4d39-ab5b-23925c339111" name="Error_Message" type="Data">
    <subsheetid>edb81c89-db1e-447e-8544-811f39c2499a</subsheetid>
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>0</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="a27c4282-35ce-4135-8645-b34da27e0a17" name="Forward Mail" type="SubSheetInfo">
    <subsheetid>0cc882a5-1042-4931-90e4-99e354e4834d</subsheetid>
    <narrative>Forward mail. Use Get Mail List action to find Id.</narrative>
    <displayx>-195</displayx>
    <displayy>-120</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="77bdade1-05c2-4a24-8414-cc46fa5f1a57" name="Start" type="Start">
    <subsheetid>0cc882a5-1042-4931-90e4-99e354e4834d</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Id" narrative="Message Id to reply to" stage="Id" />
      <input type="text" name="ToRecipients" narrative="To recipients to add" stage="To" />
      <input type="text" name="CcRecipients" narrative="Cc recipients to add" stage="CC" />
      <input type="text" name="BccRecipients" narrative="Bcc recipients to add" stage="BCC" />
      <input type="text" name="resposeMessage" narrative="Message to send" stage="resposeMessage" />
      <input type="flag" name="isHTML" narrative="Optional: False is default" stage="isHTML" />
      <input type="text" name="Attachments" narrative="Optional: Attachment list" stage="Attachments" />
      <input type="flag" name="SaveSent" narrative="Optional: Save mail in Sent folder? False is default" stage="SaveSent" />
    </inputs>
    <onsuccess>28d209fc-796a-43db-9059-6fe46eb66b00</onsuccess>
  </stage>
  <stage stageid="4a9c6e7a-2586-405d-b6c5-2f4800125cd8" name="End" type="End">
    <subsheetid>0cc882a5-1042-4931-90e4-99e354e4834d</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="Success" narrative="Success flag" stage="Success" />
      <output type="text" name="Error_Message" narrative="Error message" stage="Error_Message" />
    </outputs>
  </stage>
  <stage stageid="28d209fc-796a-43db-9059-6fe46eb66b00" name="ForwardMail" type="Code">
    <subsheetid>0cc882a5-1042-4931-90e4-99e354e4834d</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Id" expr="[Id]" />
      <input type="text" name="To" expr="[To]" />
      <input type="text" name="CC" expr="[CC]" />
      <input type="text" name="BCC" expr="[BCC]" />
      <input type="text" name="resposeMessage" expr="[resposeMessage]" />
      <input type="flag" name="isHTML" expr="[isHTML]" />
      <input type="text" name="Attachments" expr="[Attachments]" />
      <input type="flag" name="SaveSent" expr="[SaveSent]" />
    </inputs>
    <outputs>
      <output type="flag" name="Success" stage="Success" />
      <output type="text" name="Error_Message" stage="Error_Message" />
    </outputs>
    <onsuccess>4a9c6e7a-2586-405d-b6c5-2f4800125cd8</onsuccess>
    <code><![CDATA[Success = true;
Error_Message = "";
try {
	EmailMessage messageToForward = EmailMessage.Bind(service,(ItemId)Id);
	ResponseMessage responseMessage = messageToForward.CreateForward();
	
	if (isHTML) {
		responseMessage.BodyPrefix = new MessageBody(BodyType.HTML, resposeMessage);
	} else {
		responseMessage.BodyPrefix = new MessageBody(BodyType.Text, resposeMessage);
	}
	char[] splitComma =  new char[]{','};
	char[] splitAsterisk =  new char[]{'*'};
	char[] splitSemicolon =  new char[]{';'};
	char[] splitAny =  new char[]{',',';'};

	//To
	foreach (String r in To.Split(splitAny, StringSplitOptions.RemoveEmptyEntries))
	{
		responseMessage.ToRecipients.Add(r);
	}
	//CC
	foreach (String r in CC.Split(splitAny, StringSplitOptions.RemoveEmptyEntries)) 
	{
		responseMessage.CcRecipients.Add(r);
	}
	//BCC
	foreach (String r in BCC.Split(splitAny, StringSplitOptions.RemoveEmptyEntries)) 
	{
		responseMessage.BccRecipients.Add(r);
	}

	// We need to save message to add attachments
    EmailMessage responseMessageDraft = responseMessage.Save();
	
	// Add attachments
	foreach (String att in Attachments.Split(splitSemicolon, StringSplitOptions.RemoveEmptyEntries)) 
	{
		if (att.Contains(new string(splitAsterisk))) {
			String[] attArray = att.Split(splitAsterisk, StringSplitOptions.RemoveEmptyEntries);
			FileAttachment fileatt = responseMessageDraft.Attachments.AddFileAttachment(attArray[0]);
			fileatt.IsInline = true;
			fileatt.ContentId = attArray[1];
		} else {
			responseMessageDraft.Attachments.AddFileAttachment(att);
		}
	}	
	
	// AutoResolve should not be an issue, we are sending it right away.
	responseMessageDraft.Update(ConflictResolutionMode.AutoResolve);
	
	//Send
	if (SaveSent) 
	{
		responseMessageDraft.SendAndSaveCopy();
	} else {
		responseMessageDraft.Send();
	}
}
catch (Exception e) 
{
	Success = false;
	Error_Message = e.ToString();
}]]></code>
  </stage>
  <stage stageid="c78f14b8-d340-4e13-8d84-e6dbdd24e5ea" name="Success" type="Data">
    <subsheetid>0cc882a5-1042-4931-90e4-99e354e4834d</subsheetid>
    <narrative>
    </narrative>
    <displayx>-210</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>False</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="85e5bed7-cea2-4e85-90e8-9f6ca104a52d" name="Error_Message" type="Data">
    <subsheetid>0cc882a5-1042-4931-90e4-99e354e4834d</subsheetid>
    <narrative>
    </narrative>
    <displayx>-150</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="5d191820-2be6-4122-a691-8c957c4cf6b9" name="SaveSent" type="Data">
    <subsheetid>0cc882a5-1042-4931-90e4-99e354e4834d</subsheetid>
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>True</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="44bfe8e6-7b40-4109-aa71-8d6e4cac9a5d" name="Attachments" type="Data">
    <subsheetid>0cc882a5-1042-4931-90e4-99e354e4834d</subsheetid>
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="60184ef3-fa59-4516-9b14-cbb5a44255d5" name="isHTML" type="Data">
    <subsheetid>0cc882a5-1042-4931-90e4-99e354e4834d</subsheetid>
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>False</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="cc416a80-93bf-4817-8590-dbd67d7f9d5c" name="Id" type="Data">
    <subsheetid>0cc882a5-1042-4931-90e4-99e354e4834d</subsheetid>
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="06a6a1c2-93e4-4719-a0bd-d23d15d39ba0" name="resposeMessage" type="Data">
    <subsheetid>0cc882a5-1042-4931-90e4-99e354e4834d</subsheetid>
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="0316b9ac-6c1f-4a3e-bdf2-bbafb3cd5319" name="BCC" type="Data">
    <subsheetid>0cc882a5-1042-4931-90e4-99e354e4834d</subsheetid>
    <narrative>
    </narrative>
    <displayx>255</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="6970162f-5d15-4842-beaa-5e71be7dea3c" name="CC" type="Data">
    <subsheetid>0cc882a5-1042-4931-90e4-99e354e4834d</subsheetid>
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="fca06349-cd32-4343-800a-065035216ad1" name="To" type="Data">
    <subsheetid>0cc882a5-1042-4931-90e4-99e354e4834d</subsheetid>
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="30235559-d587-4c6f-a3ee-4c17fd65167f" name="Delete Item" type="SubSheetInfo">
    <subsheetid>62f373a8-15b4-4b2d-9764-5b78ee54c82a</subsheetid>
    <narrative>Delete item. Use Get Mail List action to find Id.</narrative>
    <displayx>-195</displayx>
    <displayy>-120</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="b987b684-88c9-4d91-90b1-0134ebbb54d2" name="Start" type="Start">
    <subsheetid>62f373a8-15b4-4b2d-9764-5b78ee54c82a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Id" narrative="Message Id to reply to" stage="Id" />
      <input type="flag" name="suppressReadReceipts" narrative="suppressReadReceipts flag." stage="suppressReadReceipts" />
    </inputs>
    <onsuccess>daa6a2bb-f9c4-4da7-b513-fc0d8a5b08c7</onsuccess>
  </stage>
  <stage stageid="b26f59bb-2441-4e3f-a639-0c2356aea4ee" name="End" type="End">
    <subsheetid>62f373a8-15b4-4b2d-9764-5b78ee54c82a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="Success" narrative="Success flag" stage="Success" />
      <output type="text" name="Error_Message" narrative="Error message" stage="Error_Message" />
    </outputs>
  </stage>
  <stage stageid="daa6a2bb-f9c4-4da7-b513-fc0d8a5b08c7" name="DeleteItem" type="Code">
    <subsheetid>62f373a8-15b4-4b2d-9764-5b78ee54c82a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Id" expr="[Id]" />
      <input type="flag" name="suppressReadReceipts" expr="[suppressReadReceipts]" />
    </inputs>
    <outputs>
      <output type="flag" name="Success" stage="Success" />
      <output type="text" name="Error_Message" stage="Error_Message" />
    </outputs>
    <onsuccess>b26f59bb-2441-4e3f-a639-0c2356aea4ee</onsuccess>
    <code><![CDATA[Success = true;
Error_Message = "";
try {
	Item itemToDelete = Item.Bind(service,(ItemId)Id);
	itemToDelete.Delete(DeleteMode.MoveToDeletedItems,suppressReadReceipts);
}
catch (Exception e) 
{
	Success = false;
	Error_Message = e.ToString();
}]]></code>
  </stage>
  <stage stageid="d28dd211-bb20-4f6d-804f-01893be5f6db" name="Success" type="Data">
    <subsheetid>62f373a8-15b4-4b2d-9764-5b78ee54c82a</subsheetid>
    <narrative>
    </narrative>
    <displayx>-210</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>False</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="bace23af-4100-4363-895a-bb79c4d28a21" name="Error_Message" type="Data">
    <subsheetid>62f373a8-15b4-4b2d-9764-5b78ee54c82a</subsheetid>
    <narrative>
    </narrative>
    <displayx>-150</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="2deb93c1-2589-4b3c-9153-ea58af34970d" name="Id" type="Data">
    <subsheetid>62f373a8-15b4-4b2d-9764-5b78ee54c82a</subsheetid>
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="b289e4d2-f387-42a8-b537-ab8eab3445e9" name="suppressReadReceipts" type="Data">
    <subsheetid>62f373a8-15b4-4b2d-9764-5b78ee54c82a</subsheetid>
    <narrative>
    </narrative>
    <displayx>75</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>False</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="7d4ee180-8f87-47ef-b6c6-56d61b8421a5" name="suppressReadReceipts" type="Data">
    <subsheetid>b024d2ea-8736-49c2-997b-6077e372fe79</subsheetid>
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>False</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="e1036022-5eb7-4095-9176-8cd059730c17" name="Move Item" type="SubSheetInfo">
    <subsheetid>a68c4138-c645-46e9-9732-b716123b0320</subsheetid>
    <narrative>Move item. Use Get Mail List action to find Id. 
DestinationFolder usage is in VBO description.</narrative>
    <displayx>-195</displayx>
    <displayy>-120</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="69bb17cd-b43a-48a3-ab7a-ca95a4c1f762" name="Start" type="Start">
    <subsheetid>a68c4138-c645-46e9-9732-b716123b0320</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Id" narrative="Message Id to reply to" stage="Id" />
      <input type="text" name="destinationFolderName" narrative="Destination Folder" stage="destinationFolderName" />
    </inputs>
    <onsuccess>703050a9-8ffc-472a-9a48-0238c7191c54</onsuccess>
  </stage>
  <stage stageid="ba459fd9-de7e-4295-9e28-34562ad1075e" name="End" type="End">
    <subsheetid>a68c4138-c645-46e9-9732-b716123b0320</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="Success" narrative="Success flag" stage="Success" />
      <output type="text" name="Error_Message" narrative="Error message" stage="Error_Message" />
    </outputs>
  </stage>
  <stage stageid="703050a9-8ffc-472a-9a48-0238c7191c54" name="MoveItem" type="Code">
    <subsheetid>a68c4138-c645-46e9-9732-b716123b0320</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Id" expr="[Id]" />
      <input type="text" name="destinationFolderName" expr="[destinationFolderName]" />
    </inputs>
    <outputs>
      <output type="flag" name="Success" stage="Success" />
      <output type="text" name="Error_Message" stage="Error_Message" />
    </outputs>
    <onsuccess>ba459fd9-de7e-4295-9e28-34562ad1075e</onsuccess>
    <code><![CDATA[Success = true;
Error_Message = "";
try {
	FolderId destinationFolderId = SearchFolderByName(service,destinationFolderName);
	Item itemToMove = Item.Bind(service,(ItemId)Id);
	itemToMove.Move(destinationFolderId);
}
catch (Exception e) 
{
	Success = false;
	Error_Message = e.ToString();
}]]></code>
  </stage>
  <stage stageid="7befdf84-4335-4030-88f7-4d49d5160532" name="Success" type="Data">
    <subsheetid>a68c4138-c645-46e9-9732-b716123b0320</subsheetid>
    <narrative>
    </narrative>
    <displayx>-210</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>False</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="35aef783-b1ab-43ca-9334-1bdaf2631b5d" name="Error_Message" type="Data">
    <subsheetid>a68c4138-c645-46e9-9732-b716123b0320</subsheetid>
    <narrative>
    </narrative>
    <displayx>-150</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="1d7f7778-2d7f-4f30-b83c-1ece840d687a" name="Id" type="Data">
    <subsheetid>a68c4138-c645-46e9-9732-b716123b0320</subsheetid>
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="20c18315-4f3a-4ce8-a7dc-3b15b5618a94" name="destinationFolderName" type="Data">
    <subsheetid>a68c4138-c645-46e9-9732-b716123b0320</subsheetid>
    <narrative>
    </narrative>
    <displayx>75</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="f4b6757e-af66-408d-a7af-b2dff4b1a58f" name="Get Mail List" type="SubSheetInfo">
    <subsheetid>b48f8483-0de2-4ce2-8fe0-3cea3f83da30</subsheetid>
    <narrative>Get mail list with Ids. FolderName usage is in VBO description.</narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="62b4c89a-c6f4-4dab-94e1-4c8ad3b1f193" name="Start" type="Start">
    <subsheetid>b48f8483-0de2-4ce2-8fe0-3cea3f83da30</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="number" name="pageSize" narrative="Result set size. Default is 50." stage="pageSize" />
      <input type="number" name="offset" narrative="Offset from the start of the results. Default is 0" stage="offset" />
      <input type="text" name="folderName" narrative="Optional: Folder name. Default is &quot;Inbox&quot;" stage="folderName" />
      <input type="text" name="subjectFilter" narrative="Optional: Subject search filter" stage="subjectFilter" />
      <input type="text" name="senderFilter" narrative="Optional: Sender search filter" stage="senderFilter" />
      <input type="flag" name="unreadOnly" narrative="Optional: Return only Unread mail" stage="unreadOnlyFlag" />
      <input type="flag" name="sortDateReceivedAscending" narrative="Optional: Older first?" stage="sortDateReceivedAscending" />
      <input type="datetime" name="dateFrom" narrative="Optional: Received date from" stage="dateFrom" />
      <input type="datetime" name="dateTo" narrative="Optional: Received date to" stage="dateTo" />
      <input type="collection" name="MessageView" narrative="Optional: Message View to append data" stage="MessageView" />
    </inputs>
    <onsuccess>cddbf528-3a46-4347-9448-e2473bab47a7</onsuccess>
  </stage>
  <stage stageid="7f02c49d-caeb-45ba-8f2a-ec974e008eab" name="End" type="End">
    <subsheetid>b48f8483-0de2-4ce2-8fe0-3cea3f83da30</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="collection" name="MessageView" stage="MessageView" />
      <output type="flag" name="MoreAvailable" stage="MoreAvailable" />
    </outputs>
  </stage>
  <stage stageid="cddbf528-3a46-4347-9448-e2473bab47a7" name="GetMailList" type="Code">
    <subsheetid>b48f8483-0de2-4ce2-8fe0-3cea3f83da30</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="number" name="pageSize" expr="[pageSize]" />
      <input type="number" name="offset" expr="[offset]" />
      <input type="text" name="folderName" expr="[folderName]" />
      <input type="text" name="subjectFilter" expr="[subjectFilter]" />
      <input type="text" name="senderFilter" expr="[senderFilter]" />
      <input type="flag" name="unreadOnlyFlag" expr="[unreadOnlyFlag]" />
      <input type="flag" name="sortDateReceivedAscending" expr="[sortDateReceivedAscending]" />
      <input type="datetime" name="dateFrom" expr="[dateFrom]" />
      <input type="datetime" name="dateTo" expr="[dateTo]" />
      <input type="collection" name="MessageView_in" expr="[MessageView]" />
    </inputs>
    <outputs>
      <output type="collection" name="MessageView" stage="MessageView" />
      <output type="flag" name="MoreAvailable" stage="MoreAvailable" />
    </outputs>
    <onsuccess>7f02c49d-caeb-45ba-8f2a-ec974e008eab</onsuccess>
    <code><![CDATA[DateTime year1900 = new DateTime (1900, 1, 1, 0, 0, 0, DateTimeKind.Local); 
DateTime year9999 = new DateTime (9999, 12, 31, 0, 0, 0, DateTimeKind.Local); 


// Create DT
MessageView = MessageView_in;
// Mail
ItemView view = new ItemView((int)pageSize, (int)offset, OffsetBasePoint.Beginning);
if (sortDateReceivedAscending)	view.OrderBy.Add(ItemSchema.DateTimeReceived, SortDirection.Ascending);
view.PropertySet = PropertySet.IdOnly;
FindItemsResults<Item> findResults;
List<EmailMessage> emails = new List<EmailMessage>();

FolderId SearchFolderId = SearchFolderByName(service,folderName);
var searchFilterColl = new SearchFilter.SearchFilterCollection(LogicalOperator.And);
if (subjectFilter != "") 	searchFilterColl.Add(new SearchFilter.ContainsSubstring(EmailMessageSchema.Subject, subjectFilter, ContainmentMode.Substring, ComparisonMode.Exact));
if (unreadOnlyFlag) 		searchFilterColl.Add(new SearchFilter.IsEqualTo(EmailMessageSchema.IsRead, false));
if (senderFilter != "") 	searchFilterColl.Add(new SearchFilter.IsEqualTo(EmailMessageSchema.From, new EmailAddress(senderFilter)));
if (dateFrom - TimeZoneInfo.Local.BaseUtcOffset > year1900)	searchFilterColl.Add(new SearchFilter.IsGreaterThanOrEqualTo(ItemSchema.DateTimeReceived, dateFrom - TimeZoneInfo.Local.BaseUtcOffset));
if (dateTo - TimeZoneInfo.Local.BaseUtcOffset < year9999)	searchFilterColl.Add(new SearchFilter.IsLessThan(ItemSchema.DateTimeReceived, dateTo - TimeZoneInfo.Local.BaseUtcOffset));

if (searchFilterColl.Count > 0) {
	findResults = service.FindItems(SearchFolderId, searchFilterColl, view);
} else {
	findResults = service.FindItems(SearchFolderId, view);	
}

MoreAvailable = findResults.MoreAvailable;

if (findResults.TotalCount > 0) {
	PropertySet properties = new PropertySet(BasePropertySet.FirstClassProperties, //A PropertySet with the explicit properties you want goes here
											EmailMessageSchema.Id, 
											EmailMessageSchema.Subject, 
											EmailMessageSchema.From, 
											EmailMessageSchema.ToRecipients, 
											EmailMessageSchema.CcRecipients, 
											EmailMessageSchema.BccRecipients, 
											EmailMessageSchema.IsRead, 
											EmailMessageSchema.HasAttachments, 
											EmailMessageSchema.DateTimeSent, 
											EmailMessageSchema.DateTimeReceived); 
	//properties.RequestedBodyType = BodyType.Text;
	//properties.RequestedUniqueBodyType = BodyType.Text;
	//properties.RequestedNormalizedBodyType = BodyType.Text;
	service.LoadPropertiesForItems(findResults.Items, properties);

	//Fill DT
	foreach (EmailMessage email in findResults.Items.Where(i => i is EmailMessage))
	{
		DataRow dr = MessageView.NewRow();
		dr["Id"] = email.Id.ToString();
		try {dr["Subject"] = email[EmailMessageSchema.Subject];}catch {}
		try {
			dr["FromName"] = email.From.Name;
			dr["FromAddress"] = email.From.Address;
		} catch {}
		try {dr["IsRead"] = email.IsRead;} catch {}
		try {dr["HasAttachments"] = email.HasAttachments;} catch {}
		try {dr["DateTimeSent"] = email.DateTimeSent;} catch {}
		try {dr["DateTimeReceived"] = email.DateTimeReceived;} catch {}
		
		MessageView.Rows.Add(dr);
	}
}

]]></code>
  </stage>
  <stage stageid="99f4892b-7f35-48a5-825f-b20188ea11f9" name="MessageView" type="Collection">
    <subsheetid>b48f8483-0de2-4ce2-8fe0-3cea3f83da30</subsheetid>
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>collection</datatype>
    <private />
    <alwaysinit />
    <collectioninfo>
      <field name="Id" type="text" namespace="" description="Message Id" />
      <field name="Subject" type="text" namespace="" description="Subject" />
      <field name="FromName" type="text" namespace="" description="From Name" />
      <field name="FromAddress" type="text" namespace="" description="From Address" />
      <field name="IsRead" type="flag" namespace="" description="Is Read flag" />
      <field name="HasAttachments" type="flag" namespace="" description="Has Attachments flag" />
      <field name="DateTimeSent" type="datetime" namespace="" description="DateTime Sent" />
      <field name="DateTimeReceived" type="datetime" namespace="" description="DateTime Received" />
    </collectioninfo>
  </stage>
  <stage stageid="692353a7-d2c2-46cf-96b5-80a123936595" name="MoreAvailable" type="Data">
    <subsheetid>b48f8483-0de2-4ce2-8fe0-3cea3f83da30</subsheetid>
    <narrative>
    </narrative>
    <displayx>75</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="eb6b98d1-c945-47ea-8273-5c341cc85030" name="pageSize" type="Data">
    <subsheetid>b48f8483-0de2-4ce2-8fe0-3cea3f83da30</subsheetid>
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue>50</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d01eb8e8-ccbf-47a0-9d69-c4388dee8380" name="offset" type="Data">
    <subsheetid>b48f8483-0de2-4ce2-8fe0-3cea3f83da30</subsheetid>
    <narrative>
    </narrative>
    <displayx>75</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue>0</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="801bb1bd-1cd3-4f32-8d1b-166847d0cfcf" name="folderName" type="Data">
    <subsheetid>b48f8483-0de2-4ce2-8fe0-3cea3f83da30</subsheetid>
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue xml:space="preserve">Inbox</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="07dde56f-1496-416d-87a8-69695da806b4" name="subjectFilter" type="Data">
    <subsheetid>b48f8483-0de2-4ce2-8fe0-3cea3f83da30</subsheetid>
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="43689764-7ce8-4a52-914a-67189191056e" name="MessageView" type="Collection">
    <subsheetid>edb81c89-db1e-447e-8544-811f39c2499a</subsheetid>
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>collection</datatype>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="9bc3cf2f-03dc-45d7-a7d1-176aa88379a2" name="Note4" type="Note">
    <loginhibit />
    <narrative>Item types: 
+ EmailMessage
- Appointment
- PostItem (?)
- Contact
- ContactGroup
- Task</narrative>
    <displayx>-165</displayx>
    <displayy>-15</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>150</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="2d308aef-fa36-4fe4-b07c-06deacb48186" name="Note5" type="Note">
    <loginhibit />
    <narrative>TODO:
- Appointments?
- Get contacts?
- MAPIEX porting Wrapper?

</narrative>
    <displayx>45</displayx>
    <displayy>-15</displayy>
    <displaywidth>210</displaywidth>
    <displayheight>150</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="1a4ac28f-95fe-4f63-8533-d23b6307b637" name="Folder Name usage" type="Note">
    <loginhibit />
    <narrative>[Folder Name usage]
This VBO does the following steps to find folder in mailbox:
1) Attempt to find folder with exact name. WellKnownFolderName can be found with Enum name (e.g. "Inbox", "My folder"). Limitation: If a folder has same name as in WellKnownFolderName, then WellKnownFolderName is returned, specify full path if you need to find such custom folder.
2) Attempt to find folder with a given path, starting with any symbol that is treated as a delimiter, followed by WellKnownFolderName, then any folder hierarchy. Examples: "/Inbox/MyFolder/SubFolder" or if folder name contains slashes, then use different delimiter that does not exist in any folder names "#Inbox#My/folder/with/slashes#Another folder". Limitations: path can not contain two WellKnownFolderNames, start path with the last WellKnownFolderName. "/Root/Inbox/MyFolder" won't work, use "/Inbox/MyFolder" instead.
</narrative>
    <displayx>-480</displayx>
    <displayy>15</displayy>
    <displaywidth>420</displaywidth>
    <displayheight>180</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="0000FF" />
  </stage>
  <stage stageid="81cad491-ee8f-4da0-bebf-aa400971f103" name="EscapeDataString" type="SubSheetInfo">
    <subsheetid>262b9785-395f-49ee-a46b-783d90474dfe</subsheetid>
    <narrative>
    </narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="a74abbda-8856-427e-b4a2-d4a0cd528d28" name="Start" type="Start">
    <subsheetid>262b9785-395f-49ee-a46b-783d90474dfe</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="string" stage="string" />
    </inputs>
    <onsuccess>e7a0e169-0cfd-4b76-9849-fdc449c44ba8</onsuccess>
  </stage>
  <stage stageid="2b3ccf3b-c8e4-45ae-bcca-9b214382489d" name="End" type="End">
    <subsheetid>262b9785-395f-49ee-a46b-783d90474dfe</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="text" name="urlstring" stage="string" />
    </outputs>
  </stage>
  <stage stageid="e7a0e169-0cfd-4b76-9849-fdc449c44ba8" name="EscapeDataString" type="Code">
    <subsheetid>262b9785-395f-49ee-a46b-783d90474dfe</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-90</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="textIn" expr="[string]" />
    </inputs>
    <outputs>
      <output type="text" name="textOut" stage="string" />
    </outputs>
    <onsuccess>2b3ccf3b-c8e4-45ae-bcca-9b214382489d</onsuccess>
    <code><![CDATA[//textOut = System.Net.WebUtility.UrlEncode(textIn);
//EscapeDataString properly escapes space to %20 unlike UrlEncode
textOut = System.Uri.EscapeDataString(textIn);]]></code>
  </stage>
  <stage stageid="c080a1b6-a594-41a3-89f0-2ae12dab544a" name="string" type="Data">
    <subsheetid>262b9785-395f-49ee-a46b-783d90474dfe</subsheetid>
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="78e549df-4e3e-403f-b72d-54ae05569d15" name="HtmlEncode" type="SubSheetInfo">
    <subsheetid>803a9ddd-7269-4e95-a8b6-92d7407a2c03</subsheetid>
    <narrative>HtmlEncode a string</narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="49f59d55-8fa9-4821-bbb7-4c1b6f2aabb6" name="Start" type="Start">
    <subsheetid>803a9ddd-7269-4e95-a8b6-92d7407a2c03</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="string" stage="string" />
    </inputs>
    <onsuccess>f5ec1996-f44d-48ce-a6d3-ddafac5f0aa2</onsuccess>
  </stage>
  <stage stageid="2de4e0c9-188e-4dc6-a650-8171e72fcf2f" name="End" type="End">
    <subsheetid>803a9ddd-7269-4e95-a8b6-92d7407a2c03</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="text" name="urlstring" stage="string" />
    </outputs>
  </stage>
  <stage stageid="f5ec1996-f44d-48ce-a6d3-ddafac5f0aa2" name="HtmlEncode" type="Code">
    <subsheetid>803a9ddd-7269-4e95-a8b6-92d7407a2c03</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-90</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="textIn" expr="[string]" />
    </inputs>
    <outputs>
      <output type="text" name="textOut" stage="string" />
    </outputs>
    <onsuccess>2de4e0c9-188e-4dc6-a650-8171e72fcf2f</onsuccess>
    <code><![CDATA[textOut = HttpUtility.HtmlEncode(textIn);]]></code>
  </stage>
  <stage stageid="4daabbf5-3235-4e31-920d-da2a57b9e8f6" name="string" type="Data">
    <subsheetid>803a9ddd-7269-4e95-a8b6-92d7407a2c03</subsheetid>
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="4433c7e6-0e57-4b33-9b93-0d1503ae0724" name="mailtoLink" type="SubSheetInfo">
    <subsheetid>5f99001b-44d2-4251-8a8d-cabf2104ef3a</subsheetid>
    <narrative>Create a mailto href address for a link</narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="6c056d0d-3411-4789-b686-1ebff865483a" name="Start" type="Start">
    <subsheetid>5f99001b-44d2-4251-8a8d-cabf2104ef3a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-45</displayx>
    <displayy>-150</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="to" stage="to" />
      <input type="text" name="cc" stage="cc" />
      <input type="text" name="bcc" stage="bcc" />
      <input type="text" name="subject" stage="subject" />
      <input type="text" name="body" stage="body" />
    </inputs>
    <onsuccess>950d45b6-6d02-447e-8e23-8c8e2371adc7</onsuccess>
  </stage>
  <stage stageid="956410b6-c601-41c9-9462-aa5b14d2f3d7" name="End" type="End">
    <subsheetid>5f99001b-44d2-4251-8a8d-cabf2104ef3a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-45</displayx>
    <displayy>195</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="text" name="href" stage="href" />
    </outputs>
  </stage>
  <stage stageid="44d14584-a3b9-4d04-b63d-8c1a9363f2fd" name="to" type="Data">
    <subsheetid>5f99001b-44d2-4251-8a8d-cabf2104ef3a</subsheetid>
    <narrative>
    </narrative>
    <displayx>-240</displayx>
    <displayy>-30</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="4526a73e-8238-4b92-87b3-974b61ac19aa" name="cc" type="Data">
    <subsheetid>5f99001b-44d2-4251-8a8d-cabf2104ef3a</subsheetid>
    <narrative>
    </narrative>
    <displayx>-180</displayx>
    <displayy>-30</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="f9a6ebc4-bddb-4da0-a0d5-bf8b0872556c" name="subject" type="Data">
    <subsheetid>5f99001b-44d2-4251-8a8d-cabf2104ef3a</subsheetid>
    <narrative>
    </narrative>
    <displayx>-240</displayx>
    <displayy>15</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="30e89ef8-d012-4d86-a9a3-0d0a16fb80c0" name="body" type="Data">
    <subsheetid>5f99001b-44d2-4251-8a8d-cabf2104ef3a</subsheetid>
    <narrative>
    </narrative>
    <displayx>-180</displayx>
    <displayy>15</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="7567a2e2-ba6e-40da-8d52-285126190148" name="bcc" type="Data">
    <subsheetid>5f99001b-44d2-4251-8a8d-cabf2104ef3a</subsheetid>
    <narrative>
    </narrative>
    <displayx>-120</displayx>
    <displayy>-30</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="950d45b6-6d02-447e-8e23-8c8e2371adc7" name="to" type="Decision">
    <subsheetid>5f99001b-44d2-4251-8a8d-cabf2104ef3a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-45</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[to]=&quot;&quot;" />
    <ontrue>956410b6-c601-41c9-9462-aa5b14d2f3d7</ontrue>
    <onfalse>2e495cb5-7e89-4a57-b18d-33423e2d61cf</onfalse>
  </stage>
  <stage stageid="ac10ddd9-4a4d-4bc4-9ba5-75c24d1f9890" name="cc=&quot;&quot;" type="Decision">
    <subsheetid>5f99001b-44d2-4251-8a8d-cabf2104ef3a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>-60</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[cc]=&quot;&quot;" />
    <ontrue>38f5d82f-ad33-412e-adb6-3fc37cc87ff1</ontrue>
    <onfalse>68549519-5364-4af4-aedf-c21f468fac7d</onfalse>
  </stage>
  <stage stageid="38f5d82f-ad33-412e-adb6-3fc37cc87ff1" name="bcc=&quot;&quot;" type="Decision">
    <subsheetid>5f99001b-44d2-4251-8a8d-cabf2104ef3a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>0</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[bcc]=&quot;&quot;" />
    <ontrue>68d7eb72-85e5-44e2-b95d-19314172eb4c</ontrue>
    <onfalse>3f78fd74-2b4c-4eca-9edf-9ddd9ae33122</onfalse>
  </stage>
  <stage stageid="68d7eb72-85e5-44e2-b95d-19314172eb4c" name="subj=&quot;&quot;" type="Decision">
    <subsheetid>5f99001b-44d2-4251-8a8d-cabf2104ef3a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>60</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[subject]=&quot;&quot;" />
    <ontrue>0522cdb6-25ca-44b5-887a-b54808f2f581</ontrue>
    <onfalse>e0a9f680-c05b-41a3-bdc0-5af51c913287</onfalse>
  </stage>
  <stage stageid="0522cdb6-25ca-44b5-887a-b54808f2f581" name="body=&quot;&quot;" type="Decision">
    <subsheetid>5f99001b-44d2-4251-8a8d-cabf2104ef3a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>150</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[body]=&quot;&quot;" />
    <ontrue>956410b6-c601-41c9-9462-aa5b14d2f3d7</ontrue>
    <onfalse>15b367a7-ccb9-4705-8058-90d0340c1662</onfalse>
  </stage>
  <stage stageid="97a343f1-493b-4e92-85b5-44438f4d81fc" name="href" type="Data">
    <subsheetid>5f99001b-44d2-4251-8a8d-cabf2104ef3a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-120</displayx>
    <displayy>195</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="2e495cb5-7e89-4a57-b18d-33423e2d61cf" name="to-href" type="Calculation">
    <subsheetid>5f99001b-44d2-4251-8a8d-cabf2104ef3a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>ac10ddd9-4a4d-4bc4-9ba5-75c24d1f9890</onsuccess>
    <calculation expression="&quot;mailto:&quot;&amp;[to]&amp;&quot;?&quot;" stage="href" />
  </stage>
  <stage stageid="68549519-5364-4af4-aedf-c21f468fac7d" name="cc-href" type="Calculation">
    <subsheetid>5f99001b-44d2-4251-8a8d-cabf2104ef3a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>105</displayx>
    <displayy>-60</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>38f5d82f-ad33-412e-adb6-3fc37cc87ff1</onsuccess>
    <calculation expression="[href]&amp;&quot;cc=&quot;&amp;[cc]&amp;&quot;&amp;&quot;" stage="href" />
  </stage>
  <stage stageid="3f78fd74-2b4c-4eca-9edf-9ddd9ae33122" name="bcc-href" type="Calculation">
    <subsheetid>5f99001b-44d2-4251-8a8d-cabf2104ef3a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>105</displayx>
    <displayy>0</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>68d7eb72-85e5-44e2-b95d-19314172eb4c</onsuccess>
    <calculation expression="[href]&amp;&quot;bcc=&quot;&amp;[bcc]&amp;&quot;&amp;&quot;" stage="href" />
  </stage>
  <stage stageid="7bf8fe0f-8985-482e-bbe5-7e2d34bc4c58" name="subj-href" type="Calculation">
    <subsheetid>5f99001b-44d2-4251-8a8d-cabf2104ef3a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>120</displayx>
    <displayy>105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>0522cdb6-25ca-44b5-887a-b54808f2f581</onsuccess>
    <calculation expression="[href]&amp;&quot;subject=&quot;&amp;[subject]&amp;&quot;&amp;&quot;" stage="href" />
  </stage>
  <stage stageid="e0a9f680-c05b-41a3-bdc0-5af51c913287" name="EscapeDataString" type="SubSheet">
    <subsheetid>5f99001b-44d2-4251-8a8d-cabf2104ef3a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>120</displayx>
    <displayy>60</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="string" expr="[subject]" />
    </inputs>
    <outputs>
      <output type="text" name="urlstring" stage="subject" />
    </outputs>
    <onsuccess>7bf8fe0f-8985-482e-bbe5-7e2d34bc4c58</onsuccess>
    <processid>262b9785-395f-49ee-a46b-783d90474dfe</processid>
  </stage>
  <stage stageid="15b367a7-ccb9-4705-8058-90d0340c1662" name="EscapeDataString" type="SubSheet">
    <subsheetid>5f99001b-44d2-4251-8a8d-cabf2104ef3a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>120</displayx>
    <displayy>150</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="string" expr="[body]" />
    </inputs>
    <outputs>
      <output type="text" name="urlstring" stage="body" />
    </outputs>
    <onsuccess>de02877e-eb86-4986-99d1-d731bda7bd52</onsuccess>
    <processid>262b9785-395f-49ee-a46b-783d90474dfe</processid>
  </stage>
  <stage stageid="de02877e-eb86-4986-99d1-d731bda7bd52" name="body-href" type="Calculation">
    <subsheetid>5f99001b-44d2-4251-8a8d-cabf2104ef3a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>120</displayx>
    <displayy>195</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>956410b6-c601-41c9-9462-aa5b14d2f3d7</onsuccess>
    <calculation expression="[href]&amp;&quot;body=&quot;&amp;[body]&amp;&quot;&amp;&quot;" stage="href" />
  </stage>
  <stage stageid="c78d47a4-e24a-4d18-9f3c-7d66bdc80d88" name="unreadOnlyFlag" type="Data">
    <subsheetid>b48f8483-0de2-4ce2-8fe0-3cea3f83da30</subsheetid>
    <narrative>
    </narrative>
    <displayx>315</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>False</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="cb64791c-d005-4301-95f4-c1fb1aea6e54" name="senderFilter" type="Data">
    <subsheetid>b48f8483-0de2-4ce2-8fe0-3cea3f83da30</subsheetid>
    <narrative>
    </narrative>
    <displayx>255</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="430a4037-abda-4776-b00f-e07221cdc665" name="sortDateReceivedAscending" type="Data">
    <subsheetid>b48f8483-0de2-4ce2-8fe0-3cea3f83da30</subsheetid>
    <narrative>
    </narrative>
    <displayx>375</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>False</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="8ff4a46e-c3bb-4935-bc1c-0e9d70181909" name="dateFrom" type="Data">
    <subsheetid>b48f8483-0de2-4ce2-8fe0-3cea3f83da30</subsheetid>
    <narrative>
    </narrative>
    <displayx>315</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>datetime</datatype>
    <initialvalue>1900-01-01 00:00:00Z</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="cb36c841-5f04-42f0-b345-ec6edcc86659" name="dateTo" type="Data">
    <subsheetid>b48f8483-0de2-4ce2-8fe0-3cea3f83da30</subsheetid>
    <narrative>
    </narrative>
    <displayx>375</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>datetime</datatype>
    <initialvalue>9999-12-31 00:00:00Z</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="595a188c-9fea-4121-b4da-3c40f3432187" name="KeepOriginalMessage" type="Data">
    <subsheetid>41708016-914c-4bc9-aba4-3776db6744d5</subsheetid>
    <narrative>
    </narrative>
    <displayx>315</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>True</initialvalue>
    <private />
    <alwaysinit />
  </stage>
</process>